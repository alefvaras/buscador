jQuery(function(n){const e=e=>{var t;e.length&&e.hasClass("wc-enhanced-select")&&e.select2({minimumResultsForSearch:-1,templateResult:t=function(e){return e.id?n(`<span class="yith-wcbep-select2-option"><span class="yith-wcbep-select2-option-symbol">${{greater:">",less:"<",equal:"=","greater-eq":"≥","less-eq":"≤"}[e.id]}</span>${e.text}</span>`):e.text},templateSelection:t}).removeClass("wc-enhanced-select")},o={init:()=>{n(document).on("click","#yith-wcbep-filter-products",o.openModal),n(document).on("click","#yith-wcbep-filter-products-modal-button-apply-filters",o.getProducts),n(document).on("click","#yith-wcbep-filter-products-modal-button-reset-filters",o.resetFilters),n(document).on("change","#yith-wcbep-save-as-table-view",o.toggleVisibilityToViewName),n(document).on("change","select#yith-wcbep-filter-products-product-type-field",o.handleProductTypeChange),n(document).on("change keyup","input#yith-wcbep-new-table-view-name",o.checkViewNameValidity)},getModalContent:()=>!(!o.hasOwnProperty("modal")||!o.modal)&&o.modal.elements.content,openModal:()=>{o?.modal||(o.modal=yith.ui.modal({...yithWcbep.modals.filterProducts,onClose:o.handleModalClose}),o.modal.elements.content.find("select.yith-wcbep-numeric-comparator-select").toArray().map(n).map(e),n(document).trigger("yith_fields_init"),o.maybeInitFilters())},handleModalClose:()=>{o.modal=null},maybeInitFilters:()=>{$modal=o.getModalContent();let l=o.hasOwnProperty("filters")?o.filters:yithWcbep.customFilters;l&&Object.keys(l).forEach(e=>{const t=$modal.find(".yith-wcbep-filter-products-field-"+e),i=l[e];switch(e){case"category":case"tag":case"shipping-class":t.find("select.yith-wcbep-filter-products-compare").val(i.condition).trigger("change");const a=t.find("select.yith-wcbep-filter-products-value");Object.keys(i.taxonomies).forEach(e=>{a.append(`<option value="${e}" selected>${i.taxonomies[e]}</option>`)});break;case"product-type":i.hasOwnProperty("include_variations")&&"yes"===i.include_variations&&t.find("#yith-wcbep-filter-products-product-type-field-include-variation").prop("checked",!0).trigger("change");default:i.hasOwnProperty("compare")&&t.find("select.yith-wcbep-filter-products-compare").val(i.compare).trigger("change"),i.hasOwnProperty("value")&&t.find(".yith-wcbep-filter-products-value").val(i.value).trigger("change")}})},toggleVisibilityToViewName:function(){var e=n(this),t=o.getModalContent();t&&t.find(".yith-wcbep-new-table-view-name").css("display","yes"===e.val()?"flex":"none")},handleProductTypeChange:function(){var e=n(this).val(),t=o.getModalContent();t&&t.find(".yith-wcbep-product-type__include-variations").css("display",yithBulk.inArray(e,["any","variable"])?"flex":"none")},checkViewNameValidity:function(){var e=n(this),t=!e.val()?.trim();e.closest(".yith-wcbep-new-table-view-name").toggleClass("yith-wcbep-new-table-view-name--invalid",t),t?e.parent().find(".yith-wcbep-new-table-view-name__invalid-message").slideDown():e.parent().find(".yith-wcbep-new-table-view-name__invalid-message").slideUp()},getFilters:()=>{let c={};var e=o.getModalContent();return e&&e.find(".yith-wcbep-filter-products-field-wrapper").toArray().map(n).forEach(e=>{var t=e.data("filter-type"),i=e.data("filter-id");let a={};switch(t){case"decimal":case"price":case"text":var l=e.find("input.yith-wcbep-filter-products-value").val();l&&(a={compare:e.find("select.yith-wcbep-filter-products-compare").val(),value:l});break;case"select":l=e.find("select.yith-wcbep-filter-products-value").val();l&&(a={value:l});break;case"terms":l=e.find("select.yith-wcbep-filter-products-value option:selected");if(l.length){let t={};l.toArray().map(n).forEach(e=>t[e.val()]=e.text()),a={condition:e.find("select.yith-wcbep-filter-products-compare").val(),taxonomies:t}}break;case"product-type":l=e.find("select.yith-wcbep-filter-products-value").val();a={value:l,include_variations:yithBulk.inArray(l,["any","variable"])&&e.find("#yith-wcbep-filter-products-product-type-field-include-variation").is(":checked")?"yes":"no"}}Object.keys(a).length&&(c[i]=a)}),c},getProducts:function(){const i=o.getFilters(),a=n("#yith-wcbep-table-view"),e=o.getModalContent();var t={filters:i,update_table_view:"yes",successCallback:e=>{var t;e&&e?.isSuccessCallback&&(o.filters=i,e)&&e?.newTableView&&(1<(t=a.find('option[value="custom-filters"]')).length&&t.not(":last").remove(),t.attr("value",e.newTableView.viewKey),t.html(e.newTableView.viewName),a.select2("destroy"),a.removeClass("enhanced"),n(document).trigger("yith_fields_init"),(t=n("<div>"+yithWcbep.modals.tableViews.content+"</div>")).find(".yith-wcbep-table-view-wrapper.yith-wcbep-table-view-create").before(wp.template("yith-wcbep-table-view")(e.newTableView)),yithWcbep.modals.tableViews.content=t.html())}};if("yes"===e.find("input#yith-wcbep-save-as-table-view").val()){var l=e.find("input#yith-wcbep-new-table-view-name");if(t.viewName=l.val(),!t.viewName?.trim())return void l.trigger("keyup");t.createNewView="yes",a.find("option:nth-last-child(1)").before('<option value="custom-filters" selected>'+t.viewName+"</option>")}else a.find('option[value="custom-filters"]').length?a.val("custom-filters").trigger("change",{updateTable:!1}):a.prepend('<option value="custom-filters" selected>'+yithWcbep.i18n.customFilters+"</option>");o?.modal&&o.modal.close(),n(document).trigger("yith-wcbep-load-table",t)},resetFilters:()=>{o.getModalContent().find("select, input").each((e,t)=>{t=n(t);t.is('input[type="text"], input[type="number"]')?t.val(""):t.is('input[type="checkbox"]')?(t.prop("checked",!1),t.hasClass("on_off")&&(t.val("no"),t.removeClass("onoffchecked"))):t.is("select")&&(t.is("select[multiple]")?t.val(null):t.prop("selectedIndex",0)),t.trigger("change")})}};o.init()});