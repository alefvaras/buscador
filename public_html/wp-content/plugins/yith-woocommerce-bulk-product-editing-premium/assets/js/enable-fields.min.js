jQuery(function(h){class l{constructor(e){e=h(e);this.$element=e.hasClass("yith-wcbep-enable-fields__field")?e:e.closest(".yith-wcbep-enable-fields__field"),this.$element.length&&(this.data=this.$element.data("field-options")),this.deletingClass="yith-wcbep-enable-fields__field--deleting",this.deletingErrorClass="yith-wcbep-enable-fields__field--deleting--error"}getKey(){return this.getProp("key")}getKind(){return this.getProp("kind")}getProp(e){return!!this.data.hasOwnProperty(e)&&this.data[e]}"delete"(){}getChanges(){return{}}updateData(){this.data=this.$element.data("field-options")}}class i extends l{constructor(e){super(e),this.$element.hasClass("yith-wcbep-enable-fields__field-clone")&&(e=this.getKey())&&(e=h("#"+e+".yith-wcbep-enable-fields__field:not(.yith-wcbep-enable-fields__field-clone)")).length&&(this.$element=e)}"delete"(){const t=this;let l=!1;t.$element.addClass(t.deletingClass),h.ajax({data:{kind:this.getKind(),field_id:this.getId(),action:yithWcbep.actions.deleteCustomFieldColumn,security:yithWcbep.security.deleteCustomFieldColumn},type:"POST",dataType:"json",url:yithWcbep.ajaxurl,success:e=>{e&&"success"===e?.success&&(l=!0,delete yithWcbep.columnList[t.getKey()],delete yithWcbep.customFields[t.getKey()],yithWcbep.enabledColumns=yithWcbep.enabledColumns.filter(e=>e!==t.getKey()),t.$element.remove(),p.handleSectionTitlesVisibility(),p.searchField())},complete:()=>{l?p.handleToggleAllFieldsCheckboxStatus():(t.$element.removeClass(t.deletingClass),t.$element.addClass(t.deletingErrorClass),setTimeout(()=>t.$element.removeClass(t.deletingErrorClass),1e3))}})}update(e){const l=this,i=h("#"+l.$element.prop("id")+".yith-wcbep-enable-fields__field-clone");var t={};e.newType!==this.getType()&&(t.type=e.newType),e.newId!==this.getId()&&(t.id=e.newId),e.newLabel!==this.getLabel()&&(t.label=e.newLabel),Object.keys(t).length&&(d(i.find(".yith-wcbep-enable-fields__edit-field")),h.ajax({data:{changes:t,kind:l.getKind(),field_id:l.getId(),action:yithWcbep.actions.updateCustomFieldColumn,security:yithWcbep.security.updateCustomFieldColumn},type:"POST",dataType:"json",url:yithWcbep.ajaxurl,success:e=>{var t;"success"===e?.success&&(e.data.fieldClasses="yith-wcbep-enable-fields__custom-field",i.remove(),t=l.$element.find("input.yith-wcbep-enable-fields__field-input").prop("checked"),e=h(p.templates.field.customField(e.data)),l.$element.replaceWith(e),l.$element=e,l.$element.find("input.yith-wcbep-enable-fields__field-input").prop("checked",t),delete yithWcbep.customFields[l.getKey()],delete yithWcbep.columnList[l.getKey()],l.updateData(),yithWcbep.columnList[l.getKey()]=l.getLabel(),yithWcbep.customFields[l.getKey()]={id:l.getId(),type:l.getType(),label:l.getLabel()},p.searchField())},complete:function(){s(i.find(".yith-wcbep-enable-fields__edit-field"))}}))}getId(){return this.getProp("id")}getType(){return this.getProp("type")}getLabel(){return this.getProp("label")}getChanges(){var e,t,l=this,i=h("#"+l.$element.prop("id")+".yith-wcbep-enable-fields__field-clone"),n={};return i.length&&(e=i.find("#yith-wcbep-edit-field-custom-field-id"),t=i.find("#yith-wcbep-edit-field-custom-field-type"),i=i.find("#yith-wcbep-edit-field-custom-field-label"),e!==l.getId()&&(n.id=e),t!==l.getType()&&(n.type=t),i!==l.getLabel())&&(n.label=i),n}}class n extends l{constructor(e){super(e),this.$element.hasClass("yith-wcbep-enable-fields__field-clone")&&(e=this.getProp("key"))&&(e=h("#"+e+":not(.yith-wcbep-enable-fields__field-clone)")).length&&(this.$element=e)}"delete"(){const t=this;let l=!1;t.$element.addClass(t.deletingClass),h.ajax({data:{kind:this.getKind(),taxonomy_id:this.getTaxonomy(),action:yithWcbep.actions.deleteTaxonomyFieldColumn,security:yithWcbep.security.deleteTaxonomyFieldColumn},type:"POST",dataType:"json",url:yithWcbep.ajaxurl,success:function(e){e&&"success"===e?.success&&(delete yithWcbep.columnList[t.getKey()],p.initTaxonomiesSelects(),yithWcbep.enabledColumns=yithWcbep.enabledColumns.filter(e=>e!=t.getKey()),t.$element.remove(),p.handleSectionTitlesVisibility(),l=!0,p.searchField())},complete:function(){l?p.handleToggleAllFieldsCheckboxStatus():(t.$element.removeClass(t.deletingClass),t.$element.addClass(t.deletingErrorClass),setTimeout(()=>t.$element.removeClass(t.deletingErrorClass),1e3))}})}update(e){const l=this,i=h("#"+l.$element.prop("id")+".yith-wcbep-enable-fields__field-clone");e?.taxonomy&&e.taxonomy!==this.getTaxonomy()&&(d(i.find(".yith-wcbep-enable-fields__edit-field")),h.ajax({data:{taxonomy:e.taxonomy,field_key:this.getKey(),action:yithWcbep.actions.updateTaxonomyFieldColumn,security:yithWcbep.security.updateTaxonomyFieldColumn},type:"POST",dataType:"json",url:yithWcbep.ajaxurl,success:function(e){var t;e&&"success"===e?.success&&(i.remove(),l.$element.replaceWith(p.templates.field.taxonomy(e.data)),l.updateData(),delete yithWcbep.columnList[e.oldKey],yithWcbep.columnList[e.newKey]=e.data.fieldLabel,p.initTaxonomiesSelects(),-1!==(t=yithWcbep.enabledColumns.indexOf(e.oldKey))&&yithWcbep.enabledColumns.splice(t,1),yithWcbep.enabledColumns.push(e.newKey),p.searchField())},complete:function(){s(i.find(".yith-wcbep-enable-fields__edit-field"))}}))}getTaxonomy(){return this.getProp("taxonomy")}getLabel(){return this.getProp("label")}getChanges(){var e=h("#"+this.$element.prop("id")+".yith-wcbep-enable-fields__field-clone"),t={};return e.length&&(e=e.find("#yith-wcbep-edit-field-taxonomy"))!==this.getTaxonomy()&&(t.taxonomy=e),t}}const d=e=>{e.block({message:"",overlayCSS:{backgroundColor:"#FFFFFF",opacity:.8,cursor:"wait"}})},s=e=>e.unblock(),a=e=>{let t=new l(e);if(t.$element.length)switch(t.getKind()){case"custom_field":t=new i(e);break;case"taxonomy":t=new n(e)}return!!t.$element.length&&t},p={modal:null,templates:{field:{customField:wp.template("yith-wcbep-enable-fields-custom-field"),taxonomy:wp.template("yith-wcbep-enable-fields-taxonomy-field")},editField:wp.template("yith-wcbep-enable-fields-edit-field")},selectors:{enableFieldsButton:"#yith-wcbep-enable-fields, #yith-wcbep-empty-state-due-disabled-fields .yith-wcbep-empty-state-enable-fields",notDeletingField:".yith-wcbep-enable-fields__field:not(.yith-wcbep-enable-fields__field--deleting)",toggleAllFields:"#yith-wcbep-enable-fields-toggle-all",searchField:"#yith-wcbep-enable-fields-search-column",emptySearch:".yith-wcbep-enable-fields__search-column__icon",fieldsList:".yith-wcbep-enable-fields__list",fieldsSectionTitle:{customFields:".yith-wcbep-enable-fields__kind-custom_field",taxonomies:".yith-wcbep-enable-fields__kind-taxonomy"},allFieldsCheckboxes:'.yith-wcbep-enable-fields__list .yith-wcbep-enable-fields__field:visible input[type="checkbox"]',editFieldButton:".yith-wcbep-enable-fields__field-action--edit",deleteFieldButton:".yith-wcbep-enable-fields__field-action--delete",addCustomColumnSection:{form:"form.yith-wcbep-add-custom-fields-container",type:"#yith-wcbep-custom-field-type",customFieldID:"#yith-wcbep-custom-field-id",label:"#yith-wcbep-custom-field-label",fieldsTable:".yith-wcbep-add-custom-fields__options",customColumnKindSelect:"#yith-wcbep-custom-column-kind",addFieldButton:"#yith-wcbep-add-field-button",taxonomy:"#yith-wcbep-taxonomy-field"},fieldCloneInputs:".yith-wcbep-enable-fields__field-clone input, .yith-wcbep-enable-fields__field-clone select",fieldCloneCheckbox:'.yith-wcbep-enable-fields__field-clone input[type="checkbox"].yith-wcbep-enable-fields__field-input',cancelModalButton:".yith-wcbep-enable-fields-modal-button-cancel",saveModalButton:".yith-wcbep-enable-fields-modal-button-save"},fields:{enableFieldsButton:h("#yith-wcbep-enable-fields")},init:function(){h(document).on("click",p.selectors.enableFieldsButton,p.openModal),h(document).on("change",p.selectors.fieldCloneInputs,p.handleFieldsCloneChanges),h(document).on("change",p.selectors.fieldCloneCheckbox,p.handleFieldsCloneEnablingChanges),h(document).on("change",p.selectors.addCustomColumnSection.customColumnKindSelect,p.handleFieldsVisibilityOnAddCustomColumnModal),h(document).on("change",p.selectors.toggleAllFields,p.toggleAllFields),h(document).on("change",p.selectors.allFieldsCheckboxes,p.handleToggleAllFieldsCheckboxStatus),h(document).on("change keyup",p.selectors.searchField,p.searchField),h(document).on("click",p.selectors.emptySearch,p.emptySearch)},initTaxonomiesSelects:()=>{var e,t;p?.modal&&((t=(e=p.modal.elements.content).find(".yith-wcbep-enable-fields__edit-field #yith-wcbep-edit-field-taxonomy")).length&&(field=a(t),t.find("option").toArray().forEach(e=>h(e).prop("disabled",e.value!==field.getTaxonomy()&&yithWcbep.columnList.hasOwnProperty("yith_wcbep_tf_"+e.value)))),(t=e.find("form.yith-wcbep-add-custom-fields-container select#yith-wcbep-taxonomy-field")).length)&&(t.find("option").toArray().forEach(e=>h(e).prop("disabled",yithWcbep.columnList.hasOwnProperty("yith_wcbep_tf_"+e.value))),t.is(".enhanced"))&&(t.select2("destroy").removeClass("enhanced"),p.initSelect2())},initSelect2:()=>{h(document.body).trigger("wc-enhanced-select-init")},openModal:function(){var e={...yithWcbep.modals.enableFields,onClose:p.resetModal},e=(p.modal=yith.ui.modal(e),h(p.modal.elements.main)),t=e.find(".yith-wcbep-enable-fields__field");p.closeEditFieldOption(),p.initTaxonomiesSelects(),p.emptySearch(),t.toArray().map(e=>{e=h(e).find("input");e.attr("checked",-1!==yithWcbep.enabledColumns.indexOf(e.attr("id").substring(23)))}),h(t.toArray().filter(e=>h(e).hasClass("yith-wcbep-enable-fields__field--new"))).removeClass("yith-wcbep-enable-fields__field--new"),p.handleToggleAllFieldsCheckboxStatus(),p.handleSectionTitlesVisibility(),h(p.selectors.addCustomColumnSection.form).on("submit",p.addField),h(p.selectors.addCustomColumnSection.customFieldID).on("change keyup invalid",p.handleInvalidForm),h(p.selectors.addCustomColumnSection.customColumnKindSelect).trigger("change"),p.initSelect2(),e.on("click",p.selectors.cancelModalButton,p.closeModal),e.on("click",p.selectors.saveModalButton,p.saveModal),e.on("click",p.selectors.editFieldButton,p.openEditFieldOptions),e.on("click",p.selectors.notDeletingField+" "+p.selectors.deleteFieldButton,p.deleteField),e.find(p.selectors.fieldsList).on("scroll",p.handleFieldListScroll)},updateModalContent:function(){var e,t;p.modal&&(e=h(p.modal.elements.content),t=h("<div>"+yithWcbep.modals.enableFields.content+"</div>"),e.find('input[type="checkbox"]').map((e,t)=>h(t).attr("checked",h(t).prop("checked"))),t.find(".yith-wcbep-enable-fields__list-container").html(e.find(".yith-wcbep-enable-fields__list-container").html()),yithWcbep.modals.enableFields.content=t.html())},resetModal:()=>{p.updateModalContent(),p.modal=null},closeModal:e=>{p.modal&&p.modal.close(),p.resetModal()},saveModal:()=>{var e=h(p.modal.elements.content).find("input.yith-wcbep-enable-fields__field-input:checked").map((e,t)=>t.id.replace("yith-wcbep-show-column-","")).toArray(),t=!1;d(h(p.modal.elements.main)),h.ajax({data:{enabled_field_ids:!!e.length&&e,action:yithWcbep.actions.saveEnabledFields,security:yithWcbep.security.saveEnabledFields},type:"POST",dataType:"json",url:yithWcbep.ajaxurl,success:function(e){e&&"success"===e?.success&&p?.modal&&(s(h(p.modal.elements.main)),yithWcbep.enabledColumns=p.modal.elements.content.find("input.yith-wcbep-enable-fields__field-input:checked").map((e,t)=>t.value).toArray(),h("button.yith-wcbep-products-table-column-visibility").toggleClass("yith-wcbep-button--disabled",!yithWcbep.enabledColumns.length),p.closeModal(!0),h(document).trigger("yith-wcbep-load-table"),t=!0)},complete:function(){t||s(h(p.modal.elements.main))}})},openEditFieldOptions:function(){p.closeEditFieldOption();var e=h(this).closest(".yith-wcbep-enable-fields__field"),t=e.clone().addClass("yith-wcbep-enable-fields__field-clone").removeClass("yith-wcbep-enable-fields__field--new"),l=h(p.templates.editField()),i=h(p.selectors.fieldsList),n=e[0].getBoundingClientRect().left-i[0].getBoundingClientRect().left+e.outerWidth(),d=i.outerWidth()-(e[0].getBoundingClientRect().left-i[0].getBoundingClientRect().left),s={position:"absolute","z-index":10,top:Math.round(e[0].getBoundingClientRect().top-i[0].getBoundingClientRect().top+i[0].scrollTop-1)+"px"},o=a(e),d=(d<n?(s.right=Math.max(0,Math.round(i.outerWidth()-20-n)),s.left="auto"):(s.left=Math.max(0,Math.round(e[0].getBoundingClientRect().left-i[0].getBoundingClientRect().left)),s.right="auto"),e.find("input.yith-wcbep-enable-field-kind").val());switch(d){case"custom_field":l.find("#yith-wcbep-edit-field-taxonomy").closest("tr").remove(),l.find("#yith-wcbep-edit-field-custom-field-id").val(o.getId()),l.find("#yith-wcbep-edit-field-custom-field-type").val(o.getType()),l.find("#yith-wcbep-edit-field-custom-field-label").val(o.getLabel());break;case"taxonomy":l.find("#yith-wcbep-edit-field-taxonomy").val(o.getTaxonomy()),l.find("#yith-wcbep-edit-field-custom-field-id").closest("tr").remove(),l.find("#yith-wcbep-edit-field-custom-field-type").closest("tr").remove(),l.find("#yith-wcbep-edit-field-custom-field-label").closest("tr").remove()}i.append(t),t.css(s),t.append(l),"taxonomy"===d&&p.initTaxonomiesSelects(),l.slideDown("slow"),h(document.body).trigger("wc-enhanced-select-init"),t.on("click",".yith-wcbep-enable-fields__edit-field__cancel-button",p.closeEditFieldOption),t.on("click",".yith-wcbep-enable-fields__edit-field__save-button",p.saveFieldChanges)},deleteField:function(){var e=a(h(this));e&&e["delete"]()},saveFieldChanges:function(){var e=a(this),t=h(this).closest(".yith-wcbep-enable-fields__edit-field");switch(e.getKind()){case"custom_field":var l=t.find("#yith-wcbep-edit-field-custom-field-id").val(),i=t.find("#yith-wcbep-edit-field-custom-field-type").val(),n=t.find("#yith-wcbep-edit-field-custom-field-label").val();e.update({id:e.getId(),newId:l,newType:i,newLabel:n});break;case"taxonomy":l=t.find("#yith-wcbep-edit-field-taxonomy").val();e.update({id:e.getTaxonomy(),taxonomy:l})}},closeEditFieldOption:()=>h(".yith-wcbep-enable-fields__field-clone").remove(),addField:function(e){e.preventDefault();const a=h(p.selectors.addCustomColumnSection.customColumnKindSelect).val(),t=`add${"taxonomy"===a?"Taxonomy":"CustomField"}Column`,l=yithWcbep.actions[t],i=yithWcbep.security[t],n={kind:a,action:l,security:i},c=h(p.selectors.addCustomColumnSection.form);switch(a){case"custom-field":n.field_id=h(p.selectors.addCustomColumnSection.customFieldID).val(),n.type=h(p.selectors.addCustomColumnSection.type).val(),n.label=h(p.selectors.addCustomColumnSection.label).val()??n.field_id;break;case"taxonomy":n.taxonomy=h(p.selectors.addCustomColumnSection.taxonomy).val()}d(c),h.ajax({data:n,type:"POST",dataType:"json",url:yithWcbep.ajaxurl,success:function(l){if(l&&"success"===l?.success){yithWcbep.columnList[l.data?.fieldKey]=l.data?.fieldLabel,yithWcbep.enabledColumns.push(l.data?.fieldKey),c.trigger("reset"),c.find("input:not(#yith-wcbep-custom-field-id),select").trigger("change");var i=h(".yith-wcbep-enable-fields__list");if(i.length){l.data.fieldClasses+=" yith-wcbep-enable-fields__field--new";let e,t;switch(a){case"custom-field":yithWcbep.customFields[l.data.fieldKey]={id:l.data.fieldId,type:l.data.fieldType,label:l.data.fieldLabel},e=h(p.templates.field.customField(l.data)),t=h(p.selectors.fieldsSectionTitle.customFields);var n=h(p.modal.elements.main).find(".yith-wcbep-enable-fields__custom-field");n.length&&(t=n.last());break;case"taxonomy":e=h(p.templates.field.taxonomy(l.data)),t=h(p.selectors.fieldsSectionTitle.taxonomies);n=h(p.modal.elements.main).find(".yith-wcbep-enable-fields__taxonomy-field");n.length&&(t=n.last()),p.initTaxonomiesSelects()}t.after(e),p.searchField(),p.handleSectionTitlesVisibility();var d=i.scrollTop(),s=i[0].scrollHeight-i.innerHeight(),o=()=>setTimeout(()=>e.removeClass("yith-wcbep-enable-fields__field--new"),2500);"none"!==e.css("display")?i.animate({scrollTop:s},Math.abs((d-s)/s*500),"swing",o):o()}}},complete:function(){s(c)}})},handleFieldsCloneChanges:function(){a(h(this)).getChanges()},handleFieldsCloneEnablingChanges:function(){var e=h(this);a(e).$element.find('input[type="checkbox"].yith-wcbep-enable-fields__field-input').prop("checked",e.prop("checked"))},handleFieldsVisibilityOnAddCustomColumnModal:function(){var e=h(this).val(),t=h(p.selectors.addCustomColumnSection.fieldsTable);switch(t.find("td").closest("tr:not(.yith-wcbep-add-custom-fields__kind-select-row)").hide(),t.find("tr.yith-wcbep-add-custom-fields__show-if-"+e).show(),t.find("input[required], select[required]").prop("required",!1),e){case"custom-field":h("#yith-wcbep-custom-field-id").prop("required",!0);break;case"taxonomy":h("#yith-wcbep-taxonomy-field").prop("required",!0)}},toggleAllFields:function(){h(p.selectors.allFieldsCheckboxes).prop("checked",h(this).is(":checked"))},handleToggleAllFieldsCheckboxStatus:function(){h(p.selectors.toggleAllFields).prop("checked",!h(p.selectors.allFieldsCheckboxes+":not(:checked)").length)},handleInvalidForm:function(){var e=h(this),t=e.is(":valid")?"":"#ea0034";e.css({"border-color":t,color:t})},handleFieldListScroll:function(){var e,t=h(this),l=[];!t.length||(e={top:!!t[0].scrollTop,bottom:t[0].scrollTop+t[0].offsetHeight+5<t[0].scrollHeight}).top===p.handleFieldListScroll.boxShadow?.top&&e.bottom===p.handleFieldListScroll.boxShadow?.bottom||(l.push("inset 0px 100px 30px -90px rgba(178, 198, 210,"+.5*+e.top+")"),l.push("inset 0px -100px 30px -90px rgba(178, 198, 210,"+.5*+e.bottom+")"),t.parent().find(".yith-wcbep-enable-fields__list-wrapper__shadow").css("box-shadow",l.join(", ")),p.handleFieldListScroll.boxShadow=e)},handleSectionTitlesVisibility:function(){var e,t,l;p.modal&&(t=(e=h(p.modal.elements.main)).find(p.selectors.fieldsSectionTitle.customFields),l=e.find(p.selectors.fieldsSectionTitle.taxonomies),e.find(".yith-wcbep-enable-fields__taxonomy-field:visible").length?l.show():l.hide(),e.find(".yith-wcbep-enable-fields__custom-field:visible").length?t.show():t.hide())},emptySearch:function(){h(p.selectors.searchField).val("").trigger("change")},searchField:function(){let i=0;const e=h(p.selectors.searchField),n=e.val().toLowerCase(),t=e.closest(".yith-wcbep-enable-fields__list-container").find(".yith-wcbep-enable-fields__list"),l=t.find(".yith-wcbep-enable-fields__field");l.each((e,t)=>{var t=h(t),l=-1!==t.find("input.yith-wcbep-enable-fields__field-input").val().toLowerCase().indexOf(n)||-1!==t.find(".yith-wcbep-enable-fields__field-label").text().toLowerCase().indexOf(n);t.css("display",l?"flex":"none"),l||i++}),p.handleSectionTitlesVisibility(),p.handleToggleAllFieldsCheckboxStatus(),h(p.selectors.fieldsList).trigger("scroll"),t.toggleClass("yith-wcbep-enable-fields__list--empty-search",i===l.length)}};p.init(),h(document).on("change","input, textarea, select",function(){window.onbeforeunload=function(){}})});