jQuery(function(n){const i={message:"",overlayCSS:{backgroundColor:"#FFFFFF",opacity:.8,cursor:"wait"}},s={selectors:{openModalButton:"button.yith-wcbep-products-table-column-visibility:not( .yith-wcbep-button--disabled )",saveButton:"button.yith-wcbep-columns-visibility-modal-button-save",cancelButton:"button.yith-wcbep-columns-visibility-modal-button-cancel",columnsCheckboxInputs:'.yith-wcbep-visibility-column input[type="checkbox"]',toggleAllAction:".yith-wcbep-visibility-columns-select-all-action__label, .yith-wcbep-visibility-columns-select-all-action__input",searchIcon:".yith-wcbep-visibility-columns-search-action__icon",searchInput:"input#yith-wcbep-visibility-columns-search"},modal:!1,init:()=>{n(document).on("click",s.selectors.openModalButton,s.openModal),n(document).on("click",s.selectors.saveButton,s.saveColumnsVisibility),n(document).on("click",s.selectors.cancelButton,s.closeModal),n(document).on("click",s.selectors.columnsCheckboxInputs,s.handleToggleColumnVisibility),n(document).on("click",s.selectors.toggleAllAction,s.handleToggleAllColumnsVisibility),n(document).on("click",s.selectors.searchIcon,s.maybeEmptySearch),n(document).on("change keyup",s.selectors.searchInput,s.searchColumn)},openModal:function(){if(yithWcbep.modals?.columnsVisibility){s.modal=yith.ui.modal({...yithWcbep.modals.columnsVisibility,onClose:()=>s.modal=!1});let e=n(s.modal.elements.content).find(".yith-wcbep-visibility-columns-container"),i=Object.keys(yithWcbep.columnList);i.sort((i,e)=>yithWcbep.columnList[i]>yithWcbep.columnList[e]?1:-1),i.map(i=>-1!==yithWcbep.alwaysVisibleColumns.indexOf(i)?"":e.append(wp.template("yith-wcbep-columns-visibility-column")({key:i,name:yithWcbep.columnList[i]})));var l=n(s.modal.elements.content).find(".yith-wcbep-visibility-column");l.show().removeClass("yith-wcbep-visibility-column--disabled").find('input[type="checkbox"]').attr("checked",!0),l.not(yithWcbep.enabledColumns.map(i=>".yith-wcbep-visibility-column__"+i).join(", ")).addClass("yith-wcbep-visibility-column--disabled"),l.find(yithWcbep.hiddenColumns.map(i=>"input#yith-wcbep-visibility-column-"+i).join(", ")).attr("checked",!1),s.modal.elements.content.on("scroll",s.handleColumnsListScroll),s.checkSelectAllvalue(),s.modal.elements.content.trigger("scroll")}},handleColumnsListScroll:function(){var i=n(this),e=!!i[0].scrollTop,l=i[0].scrollTop+i[0].offsetHeight+5<i[0].scrollHeight,t="inset 0px -100px 30px -90px rgba(178, 198, 210, "+.5*l+"), inset 0px 100px 30px -90px rgba(178, 198, 210, "+.5*e+")";s.handleColumnsListScroll?.upper===e&&s.handleColumnsListScroll?.lower===l||(s.handleColumnsListScroll.upper=e,s.handleColumnsListScroll.lower=l,i.find(".yith-wcbep-column-visibility-modal-content-wrapper__shadow").css("box-shadow",t))},handleToggleColumnVisibility:function(){var i=n(this);i.prop("checked",i.is(":checked")),s.checkSelectAllvalue()},handleToggleAllColumnsVisibility:function(){let i=s.getModal(),e=i.find("input#yith-wcbep-column-visibility-select-all"),l=0,t=e.is(":checked");e.attr("checked",t).trigger("change"),n(i.find(".yith-wcbep-visibility-column").toArray().filter(i=>"none"!==n(i).css("display"))).find('input[type="checkbox"]').each((i,e)=>setTimeout(()=>n(e).prop("checked",t).trigger("change"),10*l++))},checkSelectAllvalue:()=>{var i,e;s?.modal&&(e=n(s.modal.elements.main),(i=0===n(e.find(".yith-wcbep-visibility-column").toArray().filter(i=>"none"!==n(i).css("display"))).find('input[type="checkbox"]:not(:checked)').length)!==(e=e.find("#yith-wcbep-column-visibility-select-all")).prop("checked"))&&e.prop("checked",i)},closeModal:()=>s.modal&&s.modal.close(),getModal:()=>!!s?.modal.elements.main&&n(s?.modal.elements.main),saveColumnsVisibility:function(){let e=n(".yith-wcbep-visibility-column input:not(:checked)").map((i,e)=>e.value).toArray();s.modal.elements.main.block(i),n.ajax({data:{hidden_cols:e,action:yithWcbep.actions.saveColumnsVisibility,security:yithWcbep.security.saveColumnsVisibility},type:"POST",dataType:"json",url:yithWcbep.ajaxurl,success:i=>{i&&"success"===i?.success&&(s.closeModal(),yithWcbep.hiddenColumns=e,n(e.map(i=>`table.yith_wcbep_products th.column-${i}, table.yith_wcbep_products td.column-`+i).join(", ")).hide(),n(`table.yith_wcbep_products th:not(${e.map(i=>".column-"+i).join(", ")}), table.yith_wcbep_products td:not(${e.map(i=>".column-"+i).join(", ")})`).show())},complete:()=>{s.modal?.elements&&s.modal.elements?.main&&s.modal.elements.main.unblock()}})},maybeEmptySearch:()=>{var i=n("input#yith-wcbep-visibility-columns-search");i.val()&&i.val("").trigger("change")},searchColumn:function(){let c=0;const i=n(this),e=i.closest(".yith-plugin-fw__modal__content"),l=e.find(".yith-wcbep-visibility-columns-container"),t=l.find(".yith-wcbep-visibility-column:not(.yith-wcbep-visibility-column--disabled)"),o=i.val().toLowerCase();o?(e.css("height",e.innerHeight()-25+"px"),t.each((i,e)=>{var e=n(e),l=e.hasClass("yith-wcbep-visibility-column--disabled"),t=-1!==e.find("input").val().toLowerCase().indexOf(o)||-1!==e.find("label").text().toLowerCase().indexOf(o);e.css("display",!l&&t?"flex":"none"),!l&&t||c++})):(e.css("height","auto"),t.not(".yith-wcbep-visibility-column--disabled").show()),l.toggleClass("yith-wcbep-visibility-columns-container--empty-search",c===t.length),s.modal.elements.content.trigger("scroll"),s.checkSelectAllvalue()}};s.init()});