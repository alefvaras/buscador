jQuery(i=>{const o=e=>{e.block({message:"",overlayCSS:{backgroundColor:"#FFFFFF",opacity:.8,cursor:"wait"}})},a=e=>e.unblock(),c={modal:!1,selectors:{textEditors:"textarea.yith-wcbep-add-product__textarea-editor",addProductButtons:"button.yith-wcbep-products-table-add-product, button.yith-wcbep-empty-state-add-product",cancelButton:"button.yith-wcbep-add-product-modal-button-cancel",saveButton:"button.yith-wcbep-add-product-modal-button-save",salePriceSchedule:"span.yith-wcbep-add-product__sale-price-schedule",productImageButton:".yith-wcbep-add-product-field-image input.yith-plugin-fw-upload-img-url",salePriceInput:"input#yith-wcbep-add-product-sale_price-field"},init:function(){i(document).on("click",c.selectors.addProductButtons,c.openModal),i(document).on("click",c.selectors.cancelButton,c.closeModal),i(document).on("click",c.selectors.saveButton,c.createProduct),i(document).on("click",c.selectors.salePriceSchedule,c.handleSchedulePriceVisibility),i(document).on("change",c.selectors.productImageButton,c.handleProductImageChange),i(document).on("blur",c.selectors.salePriceInput,c.handleSalePriceChange)},openModal:function(){c.modal=yith.ui.modal({...yithWcbep.modals.addProduct,onClose:c.handleModalClosing}),c.modal.elements.content.find(c.selectors.textEditors).each(function(){var e="yith-wcbep-textarea-editor-"+Date.now();i(this).attr("id",e),wp.editor.initialize(e,yithBulk.wpEditorDefaultOptions)});var e=i(".yith-wcbep-add-product-field"),t=e.find("input.yith-plugin-fw-upload-img-url").attr("id");e.find('*[id^="'+t+'"]').each((e,t)=>{t=i(t);t.attr("id","yith-plugin-fw-field__"+Date.now()+t.attr("id").substring(22))}),i(document).trigger("yith_fields_init")},closeModal:()=>{var e;c?.modal&&(e=c.modal,c.modal=!1,e.close())},handleModalClosing:()=>{c?.modal&&(c.modal.elements.main.find(".blockUI").length&&o(i("#yith-wcbep-products-wp-list")),c.modal=!1)},handleProductImageChange:function(){var e=i(this);e.closest(".yith-plugin-fw-upload-container ").toggleClass("yith-wcbep-add-product-image--uploaded",!!e.val())},handleSalePriceChange:function(){var e=i(this),t=e.closest(".yith-wcbep-add-product-modal-content-wrapper").find("input#yith-wcbep-add-product-regular_price-field");"function"==typeof priceStringToNumber&&priceStringToNumber(t.val())<=priceStringToNumber(e.val())&&e.val("")},handleSchedulePriceVisibility:function(){i(".yith-wcbep-add-product-field-schedule_from-wrapper, .yith-wcbep-add-product-field-schedule_to-wrapper").each(function(){var e=i(this);e.is(":visible")?(e.fadeOut(),e.find("input").val("")):e.css("display","flex").hide().fadeIn()})},createProduct:function(){var t=c.modal.elements.main,e=c.modal.elements.content,e={name:e.find("input#yith-wcbep-add-product-title-field").val(),description:wp.editor.getContent(e.find(".yith-wcbep-add-product-field-description textarea").attr("id")),short_description:wp.editor.getContent(e.find(".yith-wcbep-add-product-field-short_description textarea").attr("id")),regular_price:e.find("#yith-wcbep-add-product-regular_price-field").val(),sale_price:e.find("#yith-wcbep-add-product-sale_price-field").val(),image_url:e.find(".yith-wcbep-add-product-field-image input.yith-plugin-fw-upload-img-url").val(),category_ids:e.find("#yith-wcbep-add-product-categories-field").val(),status:e.find("#yith-wcbep-add-product-status-field").val(),date_on_sale_from:e.find("#yith-wcbep-add-product-schedule_from-field").val(),date_on_sale_to:e.find("#yith-wcbep-add-product-schedule_to-field").val()},d=!1;o(t),i(document).trigger("yith-wcbep-update-progress-bar",{progress:50}),i.ajax({data:{product_options:e,action:yithWcbep.actions.createProduct,security:yithWcbep.security.createProduct},type:"POST",dataType:"json",url:yithWcbep.ajaxurl,success:function(e){"success"===e?.success&&e?.productID&&(d=!0,i(document).trigger("yith-wcbep-load-table",{newProductID:e?.productID,tableData:e?.tableData}))},complete:function(){var e;a(i("#yith-wcbep-products-wp-list")),d||i(document).trigger("yith-wcbep-update-progress-bar",{progress:-1}),t.closest("body").length&&(a(c.modal.elements.main),d)&&(c.modal.elements.footer.slideUp(),c.modal.elements.content.slideUp(),e=i(yithWcbep.modals.addProduct.successMessage),c.modal.elements.title.after(e),e.slideDown(),setTimeout(()=>t.closest("body").length&&c.closeModal(),6e3))}})}};c.init()});