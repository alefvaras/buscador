(()=>{class e{constructor(){this.actionForm=document.querySelector("form#mainform"),this.modals={},this.init()}init(){this.initInternationalization(),this.initModals(),this.initEventListeners(),this.initBulkActions()}initInternationalization(){this.i18n={modalEmailDescSingle:wcPreOrdersListVars.modal_email_desc_single,modalEmailDescBulk:wcPreOrdersListVars.modal_email_desc_bulk,modalEmailBtnSingle:wcPreOrdersListVars.modal_email_btn_single,modalEmailBtnBulk:wcPreOrdersListVars.modal_email_btn_bulk,modalEmailNoteBulk:wcPreOrdersListVars.modal_email_note_bulk,modalCompleteDescSingle:wcPreOrdersListVars.modal_complete_desc_single,modalCompleteDescBulk:wcPreOrdersListVars.modal_complete_desc_bulk,modalCompleteBtnSingle:wcPreOrdersListVars.modal_complete_btn_single,modalCompleteBtnBulk:wcPreOrdersListVars.modal_complete_btn_bulk,modalCancelDescSingle:wcPreOrdersListVars.modal_cancel_desc_single,modalCancelDescBulk:wcPreOrdersListVars.modal_cancel_desc_bulk,modalCancelBtnSingle:wcPreOrdersListVars.modal_cancel_btn_single,modalCancelBtnBulk:wcPreOrdersListVars.modal_cancel_btn_bulk,modalSelectAtLeastOne:wcPreOrdersListVars.modal_select_at_least_one}}initModals(){this.modals={"cancel-preorder-modal":document.getElementById("cancel-preorder-modal"),"customer-email-modal":document.getElementById("customer-email-modal"),"complete-preorder-modal":document.getElementById("complete-preorder-modal")},Object.values(this.modals).forEach((e=>{e&&!e.querySelector(".modal-close")&&this.addCloseButton(e)})),window.addEventListener("click",(e=>{e.target.classList.contains("wc-po-modal")&&this.closeModal(e.target.id)})),document.addEventListener("keydown",(e=>{"Escape"===e.key&&Object.keys(this.modals).forEach((e=>{this.closeModal(e)}))})),this.addCloseActionToCancelButtons()}addCloseButton(e){const t=document.createElement("button");t.className="modal-close",t.innerHTML="&times;",t.style.cssText="position: absolute; right: 10px; top: 10px; background: none; border: none; font-size: 24px; cursor: pointer; color: #666;",t.onclick=t=>{t.preventDefault(),e.style.display="none"},e.querySelector(".wc-po-modal-content").appendChild(t)}addCloseActionToCancelButtons(){document.querySelectorAll(".cancel-modal").forEach((e=>{e.addEventListener("click",(()=>{const t=e.closest(".wc-po-modal").id.replace("-modal","");this.closeModal(t)}))}))}initEventListeners(){document.querySelectorAll('.check-column input[type="checkbox"]').forEach((e=>{this.handleCheckboxChange(e)})),this.initSelectAllCheckboxes(),document.querySelectorAll(".wp-list-table.pre-orders td").forEach((e=>{this.handleRowClick(e)}));const e=document.querySelector('input[name="s"]');e&&e.addEventListener("keydown",(e=>{e.key})),this.actionForm&&this.actionForm.addEventListener("submit",(e=>this.handleFormSubmit(e)))}handleCheckboxChange(e){const t=e.closest("tr");t&&(setTimeout((()=>{e.checked?t.classList.add("row-checked"):t.classList.remove("row-checked")}),100),e.addEventListener("change",(()=>{t.classList.toggle("row-checked",e.checked)})))}handleRowClick(e){e.addEventListener("click",(t=>{if(t.target.closest('a, button, input, select, textarea, [role="button"]'))return;const o=e.closest("tr").querySelector('.check-column input[type="checkbox"]');o.checked=!o.checked,o.dispatchEvent(new Event("change"))}))}initBulkActions(){window.handleCancelPreOrder=(e,t,o)=>this.handleCancelPreOrder(e,t,o),window.handleCompletePreOrder=(e,t,o)=>this.handleCompletePreOrder(e,t,o),window.handleEmailCustomer=(e,t,o)=>this.handleEmailCustomer(e,t,o)}openModal(e){const t=e.endsWith("-modal")?e:`${e}-modal`,o=this.modals[t];if(!o)return;this.previouslyFocusedElement=document.activeElement,o.style.display="block",this.resetModal(o);const l=o.querySelector("textarea");l&&setTimeout((()=>{l.focus()}),100)}closeModal(e){const t=e.endsWith("-modal")?e:e+"-modal",o=this.modals[t];o&&(o.style.display="none",this.previouslyFocusedElement&&(this.previouslyFocusedElement.focus(),this.previouslyFocusedElement=null))}resetModal(e){e.querySelectorAll("textarea").forEach((e=>{e.value="",e.style.border="",e.dataset.attempted="false"})),e.querySelectorAll(".validation-message").forEach((e=>{e.style.display="none"}));const t=e.querySelector('button[id^="confirm-"]');t&&(t.disabled="customer-email-modal"===e.id),"customer-email-modal"===e.id&&this.setupEmailModalValidation(e)}setupEmailModalValidation(e){const t=e.querySelector("textarea"),o=e.querySelector('button[id^="confirm-"]'),l=t.parentNode.querySelector(".validation-message");t.addEventListener("input",(()=>{const e=!t.value.trim();o&&(o.disabled=e),e&&"true"===t.dataset.attempted?(t.style.border="1px solid #d63638",l&&(l.style.display="block")):(t.style.border="",l&&(l.style.display="none"))}))}handleFormSubmit(e){const t=document.querySelector('input[name="s"]'),o=document.getElementById("search-submit"),l=t&&(e.submitter===o||e.target===t||t.ownerDocument.activeElement===t),n=document.getElementById("post-query-submit"),a=e.submitter===n||e.target&&e.target.querySelector("#post-query-submit:focus"),r=e.target.querySelector("#submit"),c=r&&(e.submitter===r||e.target.querySelector('input[name="wc_pre_orders_action"]'));if(a||l||c)return;e.preventDefault();const s=this.actionForm.querySelector('select[name^="action"]');if(!s||"-1"===s.value)return;const i=document.querySelectorAll('input[name="order_id[]"]:checked');if(0===i.length)return this.showError(this.i18n.modalSelectAtLeastOne),void(s.value="-1");this.handleBulkAction(s.value,i)}showError(e){const t=document.createElement("div");t.className="notice notice-error",t.innerHTML=`<p>${e}</p>`,this.actionForm.parentNode.insertBefore(t,this.actionForm)}handleBulkAction(e,t){switch(e){case"message":this.handleBulkEmail(t);break;case"cancel":this.handleBulkCancel(t);break;case"complete":this.handleBulkComplete(t);break;default:this.actionForm.submit()}}handleBulkEmail(e){const t=this.modals["customer-email-modal"];if(!t)return;this.openModal("customer-email-modal"),this.resetModal(t);const o=1===e.length?this.i18n.modalEmailDescSingle:this.i18n.modalEmailDescBulk.replace("%d",e.length),l=document.getElementById("customer-email-desc"),n=document.getElementById("confirm-email-btn");l&&n&&(l.textContent=o,l.innerHTML+=e.length>1?"<br><br><strong>"+this.i18n.modalEmailNoteBulk+"</strong>":"",n.textContent=1===e.length?this.i18n.modalEmailBtnSingle:this.i18n.modalEmailBtnBulk.replace("%d",e.length),n.onclick=()=>{const e=document.getElementById("email-note");if(!e)return;const t=e.value.trim();if(!t){e.style.border="1px solid #d63638",e.dataset.attempted="true";const t=e.parentNode.querySelector(".validation-message");return void(t&&(t.style.display="block"))}const o=this.actionForm.querySelector('textarea[name="customer_message"]');o&&(o.value=t),this.closeModal("customer-email-modal"),this.actionForm.submit()})}handleBulkComplete(e){const t=this.modals["complete-preorder-modal"];if(!t)return;this.openModal("complete-preorder-modal"),this.resetModal(t);const o=document.getElementById("confirm-complete-btn");if(!o)return;const l=document.getElementById("complete-preorder-desc");l&&(l.textContent=1===e.length?this.i18n.modalCompleteDescSingle:this.i18n.modalCompleteDescBulk.replace("%d",e.length)),o.textContent=1===e.length?this.i18n.modalCompleteBtnSingle:this.i18n.modalCompleteBtnBulk.replace("%d",e.length),o.onclick=()=>{const e=document.getElementById("complete-note");if(!e)return;const t=e.value.trim();if(t){const e=this.actionForm.querySelector('textarea[name="customer_message"]');e&&(e.value=t)}this.closeModal("complete-preorder-modal"),this.actionForm.submit()}}handleBulkCancel(e){const t=this.modals["cancel-preorder-modal"];if(!t)return;this.openModal("cancel-preorder-modal"),this.resetModal(t);const o=document.getElementById("confirm-cancel-btn");if(!o)return;const l=document.getElementById("cancel-preorder-desc");l&&(l.textContent=1===e.length?this.i18n.modalCancelDescSingle:this.i18n.modalCancelDescBulk.replace("%d",e.length)),o.textContent=1===e.length?this.i18n.modalCancelBtnSingle:this.i18n.modalCancelBtnBulk.replace("%d",e.length),o.onclick=()=>{const e=document.getElementById("cancel-note");if(!e)return;const t=e.value.trim();if(t){const e=this.actionForm.querySelector('textarea[name="customer_message"]');e&&(e.value=t)}this.closeModal("cancel-preorder-modal"),this.actionForm.submit()}}handleCancelPreOrder(e,t,o){o&&(o.preventDefault(),o.stopPropagation()),this.openModal("cancel-preorder-modal");const l=document.getElementById("confirm-cancel-btn");l&&(l.onclick=()=>{const o=document.getElementById("cancel-note");if(!o)return;const l=o.value.trim(),n=new URL(window.location.href);n.searchParams.set("action","cancel_pre_order"),n.searchParams.set("order_id",e),n.searchParams.set("cancel_pre_order_nonce",t),l&&n.searchParams.set("customer_note",l),this.closeModal("cancel-preorder-modal"),window.location.href=n.toString()})}handleCompletePreOrder(e,t,o){o&&(o.preventDefault(),o.stopPropagation()),this.openModal("complete-preorder-modal");const l=document.getElementById("confirm-complete-btn");l&&(l.onclick=()=>{const o=document.getElementById("complete-note");if(!o)return;const l=o.value.trim(),n=new URL(window.location.href);n.searchParams.set("action","complete_pre_order"),n.searchParams.set("order_id",e),n.searchParams.set("complete_pre_order_nonce",t),l&&n.searchParams.set("customer_note",l),this.closeModal("complete-preorder-modal"),window.location.href=n.toString()})}handleEmailCustomer(e,t,o){o&&(o.preventDefault(),o.stopPropagation());const l=document.getElementById("customer-email-desc"),n=document.getElementById("confirm-email-btn");l&&n&&(l.textContent=this.i18n.modalEmailDescSingle,n.textContent=this.i18n.modalEmailBtnSingle,this.openModal("customer-email-modal"),n.onclick=()=>{const o=document.getElementById("email-note");if(!o)return;const l=o.value.trim();if(!l){o.style.border="1px solid #d63638",o.dataset.attempted="true";const e=o.parentNode.querySelector(".validation-message");return void(e&&(e.style.display="block"))}const n=document.createElement("form");n.method="post",n.style.display="none";const a={page:"wc_pre_orders",action:"message","order_id[]":e,_wpnonce:t,customer_message:l};Object.entries(a).forEach((([e,t])=>{const o=document.createElement("input");o.type="hidden",o.name=e,o.value=t,n.appendChild(o)})),document.body.appendChild(n),this.closeModal("customer-email-modal"),n.submit()})}initSelectAllCheckboxes(){const e=document.querySelector(".pre-orders");if(!e)return;const t=e.querySelector('thead tr input[type="checkbox"]');t&&(t.addEventListener("change",(()=>{const e=t.checked;document.querySelectorAll('input[name="order_id[]"]').forEach((t=>{t.checked=e,t.dispatchEvent(new Event("change"))}))})),document.addEventListener("change",(e=>{e.target.matches('input[name="order_id[]"]')&&this.updateSelectAllState()})))}updateSelectAllState(){const e=document.querySelectorAll('input[name="order_id[]"]');if(0===e.length)return;const t=document.querySelectorAll('input[id^="cb-select-all"]'),o=document.querySelectorAll('input[name="order_id[]"]:checked').length,l=o===e.length,n=o>0;t.forEach((e=>{e.checked=l,e.indeterminate=n&&!l}))}}document.addEventListener("DOMContentLoaded",(()=>{new e}))})();