const priceStringToNumber=e=>Math.abs(+("string"==typeof e?e.replace(yithWcbep.wcDecimalSeparator,"."):e));jQuery(function(h){let r=[],p=0,g=e=>wp.editor.getContent(e.attr("id")),b=e=>!isNaN(e),y=function(e,t,a){let i=e===t;return"object"==typeof e&&"object"==typeof t?("category"===a&&(e=Object.keys(e),t=Object.keys(t)),i=JSON.stringify(e)===JSON.stringify(t)):"string"==typeof e&&b(t)||b(e)&&"string"==typeof t?i=e.toString()===t.toString():yithBulk.isJsonString(e)&&"object"==typeof t||yithBulk.isJsonString(t)&&"object"==typeof e?(e=yithBulk.isJsonString(e)?e:JSON.stringify(e),t=yithBulk.isJsonString(t)?t:JSON.stringify(t),i=e===t):yithBulk.inArray(e,["[]","{}"])&&yithBulk.inArray(t,["[]","{}"])&&(i=!0),i},u=function(){h(document.body).trigger("yith-framework-enhanced-select-init"),h(document.body).trigger("wc-enhanced-select-init")},m=function(e){e.find(".blockUI").length||e.block({message:"",overlayCSS:{backgroundColor:"#ffffff",opacity:.8,cursor:"wait"}})},f=e=>e instanceof Date&&!isNaN(e)?`${e.getUTCFullYear()}-${(e.getUTCMonth()<9?"0":"")+(e.getUTCMonth()+1)}-`+(e.getUTCDate()<10?"0":"")+e.getUTCDate():"",w=e=>e.unblock(),v={selectors:{table:"table.yith_wcbep_products",tableCell:"table.yith_wcbep_products td",tableCellExceptOnOff:"table.yith_wcbep_products td:not(.yith-wcbep-column-onoff-type, .yith-wcbep-column-not-editable)",tableCellOnOff:"table.yith_wcbep_products td.yith-wcbep-column-onoff-type",tableHeaderAndFooterSortableLinks:"table.yith_wcbep_products thead th a, table.yith_wcbep_products tfoot th a",floatingField:{container:".yith-wcbep-floating-editing-field-container",cancelButton:".yith-wcbep-floating-editing-field-container .yith-wcbep-floating-editing-field__cancel-button",applyButton:".yith-wcbep-floating-editing-field-container .yith-wcbep-floating-editing-field__apply-button",downloadableFile:{container:".yith-wcbep-downloadable-files-container",addButton:".yith-wcbep-floating-editing-field-container .yith-wcbep-downloadable-files-container span.yith-wcbep-add-downloadable-file",removeButton:".yith-wcbep-floating-editing-field-container .yith-wcbep-downloadable-files-container span.yith-wcbep-downloadable-file-trash",changeButton:".yith-wcbep-floating-editing-field-container .yith-wcbep-downloadable-files-container span.yith-wcbep-downloadable-file-upload"},productImage:{container:".yith-wcbep-product-image-container",containerWithImage:".yith-wcbep-product-image-container--has-image",addButton:".yith-wcbep-product-image-container .yith-wcbep-product-image__action-add",editButton:".yith-wcbep-product-image-container--has-image .yith-wcbep-product-image__action-edit",removeButton:".yith-wcbep-product-image-container--has-image .yith-wcbep-product-image__action-remove"},productImageGallery:{container:".yith-wcbep-product-image-gallery-container",addButton:".yith-wcbep-product-image-gallery-container .yith-wcbep-product-image-gallery__add-image",removeButton:".yith-wcbep-product-image-gallery-container .yith-wcbep-product-image-gallery-element__remove"}},saveButton:"button.yith-wcbep-products-table-save:not(.yith-wcbep-products-table-save--saving)",undoButton:"button.yith-wcbep-products-table-undo",redoButton:"button.yith-wcbep-products-table-redo"},templates:{getFloatingFieldTemplate:e=>!!h("#tmpl-yith-wcbep-floating-editing-field-"+e).length&&wp.template("yith-wcbep-floating-editing-field-"+e),floatingFieldsContainer:wp.template("yith-wcbep-floating-edit-field")},floatingField:null,init:function(){h(document).on("click",v.maybeCloseProductFieldEditing),h(document).on("keydown",v.maybeApplyProductFieldEditingChanges),h(document).on("yith-wcbep-load-table",v.handleTableLoadingTrigger),h(document).on("yith-wcbep-update-progress-bar",v.handleUpdateProgressBarTrigger),h(document).on("click",v.selectors.tableHeaderAndFooterSortableLinks,v.handleColumnSorting),h(document).on("click",v.selectors.floatingField.cancelButton,v.closeProductFieldEditing),h(document).on("click",v.selectors.floatingField.applyButton,v.applyProductFieldEditing),h(document).on("click",v.selectors.tableCellExceptOnOff,v.editProductField),h(document).on("change",v.selectors.tableCellOnOff,v.handleOnOffFieldChange),h(document).on("click",v.selectors.saveButton,v.saveChanges),h(document).on("click",v.selectors.undoButton,v.undo),h(document).on("click",v.selectors.redoButton,v.redo),h(v.selectors.table).on("scroll",v.handleTableScroll),v.makeItResizable(),v.initNotEditableColumnsTollTips(),h(document).on("click","#yith-wcbep-products-wp-list .tablenav .pagination-links a",v.handlePaginationChange),h(document).on("click",v.selectors.floatingField.downloadableFile.removeButton,v.removeDownloadableFile),h(document).on("click",v.selectors.floatingField.downloadableFile.addButton,v.addFieldOnDownloadableFiles),h(document).on("click",v.selectors.floatingField.downloadableFile.changeButton,v.selectDownloadableFileFromMediaLibrary),h(document).on("click",v.selectors.floatingField.productImage.addButton,v.addProductImage),h(document).on("click",v.selectors.floatingField.productImage.editButton,v.changeProductImage),h(document).on("click",v.selectors.floatingField.productImage.removeButton,v.removeProductImage),h(document).on("click",v.selectors.floatingField.productImageGallery.addButton,v.addProductImageToGallery),h(document).on("click",v.selectors.floatingField.productImageGallery.removeButton,v.removeProductImageFromGallery),h(document).on("change keyup blur","input#yith-wcbep-products-table-products-per-page",v.handleProductsPerPageChanges),h(document).on("change keyup blur","input#yith-wcbep-search-for-a-product",v.handleProductsNameSearchChange),v.initToolTips(),v.initExportForms()},initToolTips:()=>{h(".yith-wcbep-products-table-button__tip,.yith-wcbep-products-table-button__tip").tipTip({attribute:"data-tip",fadeIn:150,fadeOut:150,delay:700})},initExportForms:()=>{var e=h("form.woocommerce-exporter");e.length&&e.wc_product_export_form()},handleColumnSorting:function(){var e=v.getTable(),t=h(this).closest("th"),a=t.hasClass("asc")?"asc":"desc";return e.find(`thead th.sorted:not(#${t.attr("id")})`).removeClass("sorted").addClass("sortable"),t.hasClass("sortable")&&t.removeClass("sortable").addClass("sorted"),t.removeClass(a).addClass("asc"==a?"desc":"asc"),h(document).trigger("yith-wcbep-load-table"),!1},makeItResizable:function(){var e=h(".yith-wcbep-products-table-container table.yith_wcbep_products"),t=e.find("tr"),e=e.find("th:not(.column-cb), td");t.resizable({handles:"s"}),e.resizable({handles:"e",resize:v.columnResizingHandler,stop:v.maybeUpdateColumnsWidth})},initNotEditableColumnsTollTips:()=>h(".yith-wcbep-column-not-editable").tipTip({attribute:"data-not-editable-message",fadeIn:150,fadeOut:150,delay:700}),maybeUpdateColumnsWidth:()=>{v.maybeUpdateColumnsWidth.lastResize=Date.now(),setTimeout(()=>{if(!v.maybeUpdateColumnsWidth.hasOwnProperty("lastResize")||2e3<=Date.now()-v.maybeUpdateColumnsWidth.lastResize){const e=v.getTable(),t=e.find("thead th"),a=t.toArray().filter(e=>"none"!==h(e).css("display")).map(e=>({id:e.id,width:h(e).width()}));Object.keys(a).forEach(e=>document.documentElement.style.setProperty("--yith-wcbep-column-"+a[e].id+"-width",a[e].width+"px")),h.ajax({data:{action:yithWcbep.actions.updateColumnsWidth,security:yithWcbep.security.updateColumnsWidth,columns_width:a},type:"POST",url:yithWcbep.ajaxurl,success:e=>{"success"!==e?.success&&console.warn(e)}})}},2e3)},getTable:()=>h(v.selectors.table),getTableData:()=>{var e={},t=v.getTable().find("thead th.sorted.asc, thead th.sorted.desc"),t=(t.length&&(e.order_by=t.attr("id"),e.order=t.hasClass("asc")?"asc":"desc"),e.table_view=h("select#yith-wcbep-table-view").val(),e.posts_per_page=h("input#yith-wcbep-products-table-products-per-page").val(),h("#yith-wcbep-search-for-a-product").val()),t=(t&&(e.product_name=t),h("#yith-wcbep-products-table-current-page").val());return 1!==t&&(e.paged=t),e},handleTableLoadingTrigger:(e,t)=>v.loadTable(t),loadTable:function(l){const n=h(v.selectors.table),e=n.closest("#yith-wcbep-products-wp-list"),a=e=>{if(e){v.updateProgressBar(l&&l.hasOwnProperty("endProgess")?l.endProgess:100);var t=v.getSelectedProducts(),a=n.find("tbody"),t=(n.closest("#yith-wcbep-products-wp-list ")[0].classList=e.container_classes,v.closeProductFieldEditing(),n.find("thead, tfoot").html(h("<tr></tr>").html(e?.column_headers)),a.html(e?.rows),a.find(t.map(e=>"tr.yith-wcbep-product-"+e).join(", ")).find("th.check-column input").trigger("click"),n.closest("#yith-wcbep-products-wp-list").find(".tablenav.bottom .tablenav-pages"));if(1<e?.total_pages?t.removeClass("one-page"):t.addClass("one-page"),t.html(h(e.pagination.bottom).html()),v.makeItResizable(),v.initNotEditableColumnsTollTips(),v.applyMove(r.slice(0,p),"redo"),v.handleUndoRedoUsability(),c.handleBulkButtonsStatus(),h("#yith-wcbep-products-table-total-pages").val(e?.total_pages?e.total_pages:1),e?.paged?h("#yith-wcbep-products-table-current-page").val(Math.abs(e?.paged)):h("#yith-wcbep-products-table-current-page").val(1),l?.newProductID){const i=n.find("tr.yith-wcbep-product-"+l.newProductID);i.length&&(i.addClass("yith-wcbep-new-product-row"),setTimeout(()=>i.removeClass("yith-wcbep-new-product-row"),15e3))}}else v.updateProgressBar(-1);c.productSelectionChange()};if(yithWcbep.enabledColumns.filter(e=>!yithBulk.inArray(e,yithWcbep.alwaysVisibleColumns)).length)if(e.removeClass("yith-wcbep-empty-state-due-disabled-fields"),l?.tableData)a(l.tableData),w(e);else{var i={action:yithWcbep.actions.loadProductsTable,security:yithWcbep.security.loadProductsTable,ywcbep_args:{...v.getTableData(),...l}},o=(i.ywcbep_args.hasOwnProperty("paged")&&(i.paged=i.ywcbep_args.paged),new URLSearchParams(window.location.search));o.has("lang")&&(i.lang=o.get("lang")),m(e),v.updateProgressBar(l&&l.hasOwnProperty("startProgess")?l.startProgess:50);let t=!1;h.ajax({data:i,type:"POST",url:yithWcbep.ajaxurl,success:e=>{e&&(a(e),t=!0),l&&l.hasOwnProperty("successCallback")&&l.successCallback({...e,isSuccessCallback:!0})},complete:()=>{w(e),t||v.updateProgressBar(-1),l&&l.hasOwnProperty("completeCallback")&&l.completeCallback({isCompleteCallback:!0})}})}else e.addClass("yith-wcbep-empty-state-due-disabled-fields"),e.removeClass("yith-wcbep-empty-state-due-filters yith-wcbep-empty-state-zero-products")},handleUpdateProgressBarTrigger:(e,t)=>t.hasOwnProperty("progress")&&v.updateProgressBar(t.progress),updateProgressBar:e=>{const t=h(".yith-wcbep-products-table-progress-bar"),a={success:"yith-wcbep-products-table-progress-bar--complete",failure:"yith-wcbep-products-table-progress-bar--error"},i=Math.max(Math.min(e,100),0);-1===(v.updateProgressBar.currentProgress=e)?(t.addClass(a.failure),setTimeout(()=>{t.removeClass(a.failure),-1===v.updateProgressBar.currentProgress&&t.css("width",0)},2e3)):b(i)&&(t.css("width",i+"%"),100===i?(t.addClass(a.success),setTimeout(()=>{t.removeClass(a.success),100===v.updateProgressBar.currentProgress&&t.css("width",0)},3e3)):t.removeClass(Object.values(a).join(" ")))},columnResizingHandler:function(e,t){var a=h(this),i=(a.attr("id"),a.is("td")&&a.data("col-options")?.col_name,h(this).index()+1);a.css("min-width",t.size.width),h(".yith-wcbep-products-table-container table th:nth-child("+i+"), .yith-wcbep-products-table-container table td:nth-child("+i+")").not(a).css("min-width","0px")},getEditingColumn:()=>!(!v?.floatingField||!v.floatingField?.column)&&v.floatingField.column,editProductField:function(e){var t=h(this),a=v.getEditingColumn();if(!a||a[0]!==t[0]){v.applyProductFieldEditing();var a=t.data("col-options"),i=a?.type;if(!("onoff"===i||"title"===a?.col_name&&h(e.target).is("a"))){var e=h(".yith-wcbep-products-table-container"),l=v.getFloatingField(t),n=h(v.templates.floatingFieldsContainer({editingField:l?h("<div></div>").html(l).html():""})),l=t.closest("tr"),o=t[0].getBoundingClientRect(),c=e.find("table")[0].getBoundingClientRect();n.css({position:"absolute",left:o.x-c.x+o.width/2,top:l[0].offsetTop+l.height()}),v.floatingField={type:a?.type,field:n,column:t},e.append(n);const s=v.getFloatingFieldInput();switch(i){case"image-gallery":n.find(".yith-wcbep-product-image-gallery__images").sortable({items:".yith-wcbep-product-image-gallery-element-container",opacity:.65});break;case"downloadable-files":n.find(".yith-wcbep-downloadable-files").sortable({axis:"y",items:".yith-wcbep-downloadable-file",handle:".yith-wcbep-downloadable-file-drag-handler",opacity:.65});break;case"text-editor":var d=n.find("textarea");d.length&&(d.attr("id",d.attr("id")+Date.now()),wp.editor.initialize(d.attr("id"),yithBulk.wpEditorDefaultOptions));break;case"text":s[0].selectionStart=s[0].selectionEnd=s.val().length}h(document).trigger("yith_fields_init"),u(),s&&(c=()=>{s.is("select.enhanced")?s.select2("open"):s.first().select()},"date"===i||s.is("select.enhanced")?setTimeout(c,300):c())}}},getFloatingField:function(a){var i=a.data("col-options");let l=!1;if(i?.type){let e=v.templates.getFloatingFieldTemplate(i.type);if(e){let t=a.find("input.yith-wcbep-column-value").val();switch(i.type){case"attribute":if(t=t?JSON.parse(t):{},l=h(e({taxonomy:a.find(".yith-wcbep-column-container").data("taxonomy")??""})),t?.terms){const p=l.find("select.yith-wcbep-floating-editing-field__attribute");Object.keys(t.terms).forEach(e=>{p.append(h(`<option value="${e}" selected>${t.terms[e]}</option>`))})}t?.is_visible&&l.find("input#yith-wcbep-attribute-options__is-visible").attr("checked",!0),t?.is_variation&&l.find("input#yith-wcbep-attribute-options__is-variation").attr("checked",!0);break;case"image":t=t?JSON.parse(t):{},l=h(e()),t?.image_url&&(l.addClass("yith-wcbep-product-image-container--has-image"),l.prepend(h(`<img src="${t.image_url}" data-image-id="${t.image_id}">`)));break;case"image-gallery":t=t?JSON.parse(t):[],l=h(e());const o=v.templates.getFloatingFieldTemplate("image-gallery-element"),c=l.find(".yith-wcbep-product-image-gallery__images");Object.values(t).reverse().forEach(e=>c.prepend(o(e)));break;case"downloadable-files":t=t?JSON.parse(t):[{}],l=h(e());const d=v.templates.getFloatingFieldTemplate("downloadable-file"),s=l.find(".yith-wcbep-downloadable-files");Object.values(t).forEach(e=>s.append(d(e)));break;case"date":var n=t?new Date(1e3*t):"";l=h(e({value:t?f(n):""}));break;case"status":case"tax-class":case"tax-status":case"visibility":case"product-type":case"stock-status":case"shipping-class":case"allow-backorders":(l=h(e({value:t}))).find('option[value="'+t+'"]').attr("selected",!0);break;case"taxonomy":n=i?.col_name.substring(14);const r=(l=h(e({taxonomyID:n}))).find("select");t=t?JSON.parse(t):{},"yith_shop_vendor"===n&&r.attr("multiple",!1),Object.keys(t).forEach(e=>r.append(`<option value ="${e}" selected>${t[e]}</option>`));break;case"price":t=yithBulk.formatPrice(t);default:if(l=h(e({value:t})),yithBulk.isJsonString(t)){const u=l.find("select[multiple]");t=JSON.parse(t),u.length&&Object.keys(t).forEach(e=>u.append(`<option value="${e}" selected>${t[e]}</option>`))}l=wp.hooks.applyFilters("yithWcbepGetFloatingField",l,i,t,e)}}else e=e||v.templates.getFloatingFieldTemplate("text"),l=h(e({value:a.text()}))}return l},getColumnInput:function(e){e=!!e&&e.find("input.yith-wcbep-column-value");return!!e?.length&&e},getColumnDisplayContainer:function(e){e=!!e&&e.find(".yith-wcbep-column-container");return!!e?.length&&e},updateColumnValue:function(t,i,e){if(e=undefined===e||e,!t.length||t.hasClass("yith-wcbep-column-not-editable"))return!1;let l=!1;var n=v.getColumnInput(t),o=v.getColumnDisplayContainer(t),c=o.data("initial-value");if(n){let a=n.val();var d,s=t.data("col-options"),r=s.type;switch(r){case"attribute":a=a?JSON.parse(a):{},o.html('<div class="yith-wcbep-select-values">'+Object.values(i?.terms).join(", ")+"</div>"),i={...a,...i},n.val(i?JSON.stringify(i):"");break;case"date":{let e="";i&&(i=b(i)?i:new Date(i).getTime()/1e3,i=new Date(1e3*i),"sale_price_to"===s?.col_name?i.setUTCHours(23,59,59):i.setUTCHours(0,0,1),e=f(i),i=i.getTime()/1e3),n.val(i),o.html(e)}break;case"image":a=a?JSON.parse(a):"",o.html(i?`<img src="${i.image_url}">`:""),n.val(i?JSON.stringify(i):"");break;case"image-gallery":{a=a?JSON.parse(a):"";let t=h('<div class="yith-wcbep-table-image-gallery"></div>');i.length&&i.forEach(e=>{t.append(`<img src="${e.image_url}">`)}),o.html(t),n.val(i?JSON.stringify(i):"")}break;case"downloadable-files":a=a?JSON.parse(n.val()):"";let e="";0<i.length?e=yithWcbep.i18n.downloadableFiles[1===i.length?"singular":"plural"].replace("%s",i.length):i="",o.html(e),n.val(i?JSON.stringify(i):"");break;case"category":case"products":case"tag":case"taxonomy":i=0<Object.keys(i).length?i:{},a=a?JSON.parse(a):{},o.html('<div class="yith-wcbep-select-values">'+Object.values(i).join(", ")+"</div>"),n.val(JSON.stringify(i));break;case"price":"sale_price"===s?.col_name?i=""!==i&&priceStringToNumber(v.getProductFieldValue(t.closest("tr").find("td.column-regular_price")))<=priceStringToNumber(i)?c:i:"regular_price"===s?.col_name&&(d=t.closest("tr").find("td.column-sale_price"),p=priceStringToNumber(v.getProductFieldValue(d)),priceStringToNumber(i)<=p)&&(l=[v.updateColumnValue(d,"",!1)]),i=i&&priceStringToNumber(i),"yes"===yithWcbep.roundPrices&&(i=i&&Math.round(Math.pow(10,yithWcbep.wcDecimals)*i)/Math.pow(10,yithWcbep.wcDecimals)),n.val(i),o.find(".yith-wcbep-price-amount").html(yithBulk.formatPrice(i)),o.find(".yith-wcbep-price-currency").css("display",""!==i?"block":"none");break;case"onoff":n.val(i);var p=o.find('.yith-plugin-fw-onoff-container input[type="checkbox"].on_off');"yes"===i?p.addClass("onoffchecked"):p.removeClass("onoffchecked"),p.val(i),p.prop("checked","yes"===i);break;case"text-editor":n.val(i),o.html(h('<div class="yith-wcbep-text-editor-content"></div>').html(i));break;default:{let e=i;({value:i,display:e}=wp.hooks.applyFilters("yithWcbepUpdateColumnValue",{value:i,display:e},s,o)),e===i&&"object"==typeof(i=yithBulk.maybeParseJSON(i))&&(i=i.hasOwnProperty("value")&&i.hasOwnProperty("text")?(e=i.text,i.value):(e=(Array.isArray(i)?i:Object.values(i)).join(", "),JSON.stringify(i))),n.val(i),o.html(e)}}var u=o.attr("data-unit-of-measure");return u&&o.text()&&o.append(" "+u),y(c,i,r)?t.removeClass("yith-wcbep-column--changed"):t.addClass("yith-wcbep-column--changed"),y(a,i)||(u={column:t,from:a,to:i},Array.isArray(l)?l.unshift(u):l=u),l&&e&&v.addMove(l),v.handleUndoRedoUsability(),l}},addMove:e=>{var t,a;Array.isArray(e)&&0===e.length||(p<r.length&&(r=r.slice(0,p)),(t=e?.column)&&t.length&&(a=t.data("col-options"),e.productID=t.closest("tr").data("product-id"),e.colName=a.col_name),p=r.push(e),v.handleUndoRedoUsability())},handleUndoRedoUsability:()=>{var e=h(".yith-wcbep-products-table-save");p<1?e.addClass("yith-wcbep-products-table-save--disabled"):e.removeClass("yith-wcbep-products-table-save--disabled"),h(".yith-wcbep-products-table-undo").attr("disabled",p<1),h(".yith-wcbep-products-table-redo").attr("disabled",r.length<=p)},getProductFieldEditingType:()=>{let e="";var t;return v?.floatingField&&(v.floatingField?.type?e=v.floatingField?.type:v.floatingField?.column&&(t=v.floatingField.column.data("col-options"))?.type&&(e=t.type)),e},getFloatingFieldInput:()=>{let e=!1;if(v?.floatingField&&v.floatingField?.field){var t=v.getProductFieldEditingType();switch(t){case"attribute":case"image":case"image-gallery":e=v.floatingField.field;break;case"downloadable-files":e=v.floatingField.field.find(".yith-wcbep-downloadable-file:nth-child(1) .yith-wcbep-downloadable-file__name input");break;case"tag":case"status":case"category":case"products":case"taxonomy":case"prod_type":case"tax-class":case"visibility":case"tax-status":case"product-type":case"stock-status":case"shipping-class":case"allow-backorders":e=v.floatingField.field.find("select");break;case"text-editor":e=v.floatingField.field.find("textarea");break;default:(e=v.floatingField.field.find("input")).length&&!e.hasClass("select2-search__field")||(e=v.floatingField.field.find("select")),e=wp.hooks.applyFilters("yithWcbepGetFloatingFieldInput",e,v.floatingField.field,t)}}return e},getFloatingFieldValue:()=>{var e=v.getProductFieldEditingType();let a="";if(e){var t=v.getFloatingFieldInput();switch(e){case"attribute":const l={};t.find("select.yith-wcbep-floating-editing-field__attribute option:selected").each((e,t)=>{l[t.value]=t.text}),a={is_visible:+t.find("input#yith-wcbep-attribute-options__is-visible").is(":checked"),is_variation:+t.find("input#yith-wcbep-attribute-options__is-variation").is(":checked"),terms:l};break;case"date":var i=t.val(),i=!!i&&new Date(i);a=i?f(i):"";break;case"image":i=t.find("img");i.length&&(a={image_id:i.data("image-id"),image_url:i.attr("src")});break;case"image-gallery":a=[],t.find(".yith-wcbep-product-image-gallery-element-container").each((e,t)=>{t=h(t).find("img");a.push({image_id:t.data("image-id"),image_url:t.attr("src")})});break;case"downloadable-files":a=[],t.closest(".yith-wcbep-downloadable-files").find(".yith-wcbep-downloadable-file").each((e,t)=>{a.push({name:h(t).find(".yith-wcbep-downloadable-file__name input").val(),file:h(t).find(".yith-wcbep-downloadable-file__file input").val()})}),a=a.filter(e=>!!e.file);break;case"category":case"products":case"tag":case"taxonomy":a={},t.find("option:selected").each((e,t)=>a[t.value]=t.innerText);break;case"text-editor":a=g(t);break;case"price":case"sale_price":a=t.val().toString().replace(yithWcbep.wcDecimalSeparator,"."),a=b(parseFloat(a))?parseFloat(a):a;break;default:t.length&&(t.is("input")?a=t.val():t.is("select")&&(t.prop("multiple")?(a={},t.find("option:selected").toArray().forEach(e=>a[e.value]=e.text)):a={value:t.val(),text:t.find("option:selected").text()})),a=wp.hooks.applyFilters("yithWcbepGetFloatingFieldValue",a,t,e)}}return a},getProductFieldValue:e=>(e=e?h(e):v?.floatingField?.column).find("input.yith-wcbep-column-value").val(),applyProductFieldEditing:()=>{v.floatingField?.column&&(v.updateColumnValue(v.floatingField.column,v.getFloatingFieldValue()),v.closeProductFieldEditing())},isProductFieldEditingOpened:()=>!!v.floatingField,closeProductFieldEditing:()=>{v.floatingField&&(h(".yith-wcbep-floating-editing-field-container").remove(),v.floatingField?.column)&&delete v.floatingField},maybeCloseProductFieldEditing:e=>{const t=!(!e||!e.hasOwnProperty("target"))&&h(e.target),a=["select2-selection__choice__remove","media-modal-backdrop","yith-wcbep-product-image-gallery-element__remove","ui-icon-circle-triangle-w","ui-icon-circle-triangle-e","yith-wcbep-downloadable-file-trash"];let i=!1;t&&[...t[0].classList].forEach(e=>i=-1!==a.indexOf(e)||i),t&&(t.closest([".mce-btn",".yith-wcbep-products-table-container",".select2-dropdown",".media-modal",".mce-container",".mce-container-body",".ui-datepicker"].join(", ")).length||i)||v.applyProductFieldEditing()},maybeApplyProductFieldEditingChanges:e=>{13===e?.keyCode&&v.isProductFieldEditingOpened()&&v.applyProductFieldEditing()},handleTableScroll:function(){var e,t,a;v.floatingField&&v.floatingField?.field&&v.floatingField?.column&&(e=h("table.yith_wcbep_products"),t=v.floatingField.column[0].getBoundingClientRect(),a=e[0].getBoundingClientRect(),(left=t.x-a.x+t.width/2)<=e.width()+e[0].offsetLeft&&0<=left?v.floatingField.field.css({left:left}):(v.floatingField.field.remove(),v.floatingField=null))},applyMove:(e,t)=>{var a=yithWcbep.roundPrices;yithWcbep.roundPrices="no",Array.isArray(e)?e.forEach(e=>v.applyMove(e,t)):(e?.column&&!e.column.closest("body").length&&(e.column=h(v.getTable().find("tr.yith-wcbep-product-"+e.productID+" td.column-"+e.colName))),e?.column&&e.column.length&&v.updateColumnValue(e.column,"undo"===t?e.from:e.to,!1)),yithWcbep.roundPrices=a},undo:function(){var e;0<p&&(e=r[--p],v.applyMove(e,"undo")),v.handleUndoRedoUsability()},redo:function(){var e;r.length>p&&0<=p&&(e=r[p++],v.applyMove(e,"redo")),v.handleUndoRedoUsability()},handlePaginationChange:function(e){e.preventDefault();var e=h("#yith-wcbep-products-table-current-page"),t=h("#yith-wcbep-products-table-total-pages"),a=h(this);let i=parseInt(e.val());a.hasClass("next-page")&&i<t.val()?i++:a.hasClass("last-page")?i=parseInt(t.val()):a.hasClass("prev-page")&&1<e.val()?i--:a.hasClass("first-page")&&(i=1),i!==parseInt(e.val())&&(e.val(i),h(document).trigger("yith-wcbep-load-table",{paged:i}))},selectDownloadableFileFromMediaLibrary:function(){const t=h(this).parent().find(".yith-wcbep-downloadable-file__file input"),a=wp.media();a.open(),a.on("select",function(){var e=a.state().get("selection").first().toJSON();t.val(e.url)})},addFieldOnDownloadableFiles:function(){var e=h(this).closest(".yith-wcbep-downloadable-files-container").find(".yith-wcbep-downloadable-files"),t=v.templates.getFloatingFieldTemplate("downloadable-file");e.append(t({}))},removeDownloadableFile:function(){var e=h(this).closest(".yith-wcbep-downloadable-file"),t=e.parent();e.remove(),0===t.find(".yith-wcbep-downloadable-file").length&&t.parent().find(".yith-wcbep-add-downloadable-file").trigger("click")},addProductImage:function(){const a=h(this).closest(".yith-wcbep-product-image-container"),i=wp.media({});i.open(),i.on("select",function(){var e=i.state().get("selection").first().toJSON(),t=h("<img>");a.addClass("yith-wcbep-product-image-container--has-image"),a.prepend(t),t.attr("data-image-id",e.id),t.attr("src",e.url)})},changeProductImage:function(){const a=h(this).closest(".yith-wcbep-product-image-container"),i=wp.media();i.open(),i.on("select",function(){let e=i.state().get("selection").first().toJSON(),t=a.find("img");t.length||(t=h("<img>"),a.prepend(t)),t.attr("data-image-id",e.id),t.attr("src",e.url)})},removeProductImage:function(){var e=h(this).closest(".yith-wcbep-product-image-container");e.removeClass("yith-wcbep-product-image-container--has-image"),e.find("img").remove()},addProductImageToGallery:function(){const a=h(this),i=a.parent(),l=wp.media({multiple:"add"});l.open(),l.on("select",function(){const e=l.state().get("selection").map(e=>e.toJSON()),t=v.templates.getFloatingFieldTemplate("image-gallery-element");e.filter(e=>0===i.find(`img[data-image-id="${e.id}"]`).length).forEach(e=>a.before(t({image_id:e.id,image_url:e.url})))})},removeProductImageFromGallery:function(){h(this).closest(".yith-wcbep-product-image-gallery-element-container").remove()},getSelectedProducts:()=>h(v.selectors.table+" tbody .check-column input:checked").map((e,t)=>t.value).toArray(),handleProductsPerPageChanges:function(e){v.handleProductsPerPageChanges.lastTimeChanged=Date.now();const t=h(this),a=parseInt(t.val()),i=Math.max(b(a)?Math.abs(a):1,1),l=()=>v.loadTable({update_products_per_page:1}),n=e=>{(!(e=undefined===e||e)||1500<=Date.now()-v.handleProductsPerPageChanges.lastTimeChanged)&&v.handleProductsPerPageChanges.lastValue!==i&&(v.handleProductsPerPageChanges.lastValue=i,h("#yith-wcbep-products-table-current-page").val(1),l())};"focusout"===e?.type?(t.val(i),n(!1)):setTimeout(n,1500)},handleProductsNameSearchChange:function(e){v.handleProductsNameSearchChange.lastTimeChanged=Date.now();const t=h(this),a=t.val(),i=e=>{(!(e=undefined===e||e)||1500<=Date.now()-v.handleProductsNameSearchChange.lastTimeChanged)&&v.handleProductsNameSearchChange.lastValue!==a&&(v.handleProductsNameSearchChange.lastValue=a,v.loadTable())};"focusout"===e?.type?i(!1):setTimeout(i,1500)},handleOnOffFieldChange:function(){var e=h(this);v.updateColumnValue(e,e.find('.yith-plugin-fw-onoff-container  input[type="checkbox"].on_off').val())},saveChanges:function(){v.maybeCloseProductFieldEditing();let i=0,e=!1;const l=h(this),t=v.getTable(),n=t.closest("#yith-wcbep-products-wp-list"),o=v.getChanges(),c=Object.keys(o),d=100/(2*(Math.ceil(c.length/yithWcbep.productsToSavePerRequest)+1)),s=()=>{let t=!1;if(i+=d,v.updateProgressBar(i),c.length&&!e){const a={};c.splice(0,yithWcbep.productsToSavePerRequest).forEach(e=>{a[e]=o[e]}),h.ajax({data:{action:yithWcbep.actions.saveProductsChanges,security:yithWcbep.security.saveProductsChanges,products_changes:a},type:"POST",url:yithWcbep.ajaxurl,success:function(e){"success"===e?.success&&(t=!0,i+=d,v.updateProgressBar(i))},complete:()=>{e=!t,s()}})}else e?(v.updateProgressBar(-1),w(n)):(r=[],p=0,v.loadTable({startProgess:i})),l.removeClass("yith-wcbep-products-table-save--saving")};l.addClass("yith-wcbep-products-table-save--saving"),m(n),s()},getChanges:()=>{var e=v.getTable();let i={};return e.find("tbody tr").each((e,t)=>{var t=h(t),a=+t.data("product-id");let l={};t.find("td").each((e,t)=>{var t=h(t),a=t.data("col-options"),i=v.getColumnInput(t);i&&(t=t.find(".yith-wcbep-column-container"),i=i.val(),t=t.attr("data-initial-value"),!y(t,i))&&a?.col_name&&(l[a.col_name]=i)}),Object.keys(l).length&&(i[a]=l)}),i}},o={selectors:{productsTable:"table.yith_wcbep_products",checkedProductsCheckbox:"table.yith_wcbep_products tbody tr th.check-column input:checked",applyBulkAction:"button.yith-wcbep-products-table-apply-bulk-action",bulkActionSelect:"select#yith-wcbep-bulk-action"},init:function(){h(document).on("click",o.selectors.applyBulkAction,o.handleBulkAction)},handleBulkAction:function(){const e=h(this).closest(".yith-wcbep-products-table-bulk-actions-container"),t=h(o.selectors.bulkActionSelect).val(),a=v.getSelectedProducts(),i=function(){m(e),h.ajax({data:{bulk_action:t,product_ids:a,action:yithWcbep.actions.bulkActions,security:yithWcbep.security.bulkActions},type:"POST",url:yithWcbep.ajaxurl,success:function(e){"success"===e?.success&&h(document).trigger("yith-wcbep-load-table")},complete:()=>w(e)})};if(a.length)switch(t){case"edit":c.openModal();break;case"delete":yith.ui.confirm({...yithWcbep.modals.confirmProductDeletion,onConfirm:i,classes:{confirm:"yith-wcbep-confirm-delete-button"}});break;case"export":const l=h("#yith-wcbep-export-form"),n=()=>{l.hasClass("woocommerce-exporter__exporting")?setTimeout(n,1500):($formContainer.removeClass("yith-wcbep-export-form-container--exporting").addClass("yith-wcbep-export-form-container--exported"),setTimeout(()=>$formContainer.removeClass("yith-wcbep-export-form-container--exported"),300))};($formContainer=l.closest(".yith-wcbep-export-form-container")).removeClass("yith-wcbep-export-form-container--exported").addClass("yith-wcbep-export-form-container--exporting"),l.find("input#yith-wcbep-export-form__selected-products").val(JSON.stringify(v.getSelectedProducts())),l.submit(),n();break;default:i()}}},c={modal:null,init:()=>{h(document).on("click","button.yith-wcbep-products-table-bulk-editing",c.openModal),h(document).on("change",v.selectors.table+" .check-column input",c.productSelectionChange),h(document).on("change",".yith-wcbep-bulk-editing-field .yith-wcbep-bulk-editing-field__options select.yith-wcbep-bulk-editing-field-action",c.handleFieldActionChange),h(document).on("click",".yith-wcbep-bulk-editing-field-upload-image .yith-wcbep-bulk-editing-upload-image-container:not(.yith-wcbep-bulk-editing-upload-image-container--uploaded)",c.handleImageUpload),h(document).on("click",".yith-wcbep-bulk-editing-field-upload-image .yith-wcbep-bulk-editing-upload-image-container--uploaded .yith-wcbep-bulk-editing-upload-image--remove",c.handleImageRemove),h(document).on("click",".yith-wcbep-bulk-editing-field-upload-multiple-images .yith-wcbep-bulk-editing-upload-image-container:not(.yith-wcbep-bulk-editing-upload-image-container--uploaded)",c.handleMultipleImageUpload),h(document).on("click",".yith-wcbep-bulk-editing-field-upload-multiple-images .yith-wcbep-bulk-editing-upload-image-container--uploaded .yith-wcbep-bulk-editing-upload-image--remove",c.removeImageFromList),h(document).on("click",".yith-wcbep-bulk-editing-field--has-advanced-options .yith-wcbep-bulk-editing-field__label",c.toggleFieldAdvancedOptions),h(document).on("click",".yith-wcbep-bulk-editing-field-sale-price .yith-wcbep-bulk-editing-toggle-sale-price-scheduling",c.toggleSalePriceScheduleFields),h(document).on("click","button.yith-wcbep-bulk-editing-modal-button-save",c.saveChanges),h(document).on("click","button.yith-wcbep-bulk-editing-modal-button-cancel",c.closeModal),h(document).on("click",'.yith-wcbep-bulk-editing-container ul.yith-plugin-fw__tabs > li.yith-plugin-fw__tab > a.yith-plugin-fw__tab__handler[href="#yith-wcbep-bulk-editing-custom-fields"]',c.renderCustomFieldsTab),h(document).on("click",'.yith-wcbep-bulk-editing-container ul.yith-plugin-fw__tabs > li.yith-plugin-fw__tab > a.yith-plugin-fw__tab__handler[href="#yith-wcbep-bulk-editing-custom-taxonomies"]',c.renderCustomTaxonomiesTab),h(document).on("click",".yith-wcbep-button--disabled",c.shakeButton)},shakeButton:function(){const e=h(this);e.addClass("yith-wcbep-button-disabled--shaking"),setTimeout(()=>e.removeClass("yith-wcbep-button-disabled--shaking"),900)},openModal:()=>{var e,t,a,i;null===c.modal&&v.getSelectedProducts().length&&(c.modal=yith.ui.modal({onClose:()=>c.modal=null,...yithWcbep.modals.bulkEditing}),t=(e=c.modal.elements.content).find(".yith-wcbep-bulk-editing-container .yith-plugin-fw__tabs"),a=yithWcbep.enabledColumns.filter(e=>-1!==e.indexOf("yith_wcbep_cf")&&yithWcbep.columnList.hasOwnProperty(e)).length?"block":"none",i=yithWcbep.enabledColumns.filter(e=>-1!==e.indexOf("yith_wcbep_tf")&&yithWcbep.columnList.hasOwnProperty(e)).length?"block":"none",t.find('li.yith-plugin-fw__tab a[href="#yith-wcbep-bulk-editing-custom-fields"]').parent().css("display",a),t.find('li.yith-plugin-fw__tab a[href="#yith-wcbep-bulk-editing-custom-taxonomies"]').parent().css("display",i),e.find('select#yith-wcbep-bulk-editing-sale-price-sale_price-action option[value$="from-regular"]').attr("disabled",!yithBulk.inArray("regular_price",yithWcbep.enabledColumns)),e.find("textarea.yith-wcbep-bulk-editing-text-editor, textarea.yith-wcbep-bulk-editing-replace-text-editor-with").each((e,t)=>{t=h(t);t.attr("id",t.attr("id")+Date.now()),wp.editor.initialize(t.attr("id"),yithBulk.wpEditorDefaultOptions)}),h(document).trigger("yith-plugin-fw-tabs-init").trigger("yith_fields_init"),c.updateFieldsVisibility(),u())},closeModal:()=>{null!==c.modal&&(c.modal.close(),c.modal=null)},updateFieldsVisibility:()=>{if(c?.modal){const t=c.modal.elements.content;t.find("div.yith-plugin-fw__tab-panel:not(#yith-wcbep-bulk-editing-custom-fields, #yith-wcbep-bulk-editing-custom-taxonomies)").toArray().forEach(e=>{e=h(e);let i=!1;e.find(".yith-wcbep-bulk-editing-field").toArray().forEach(e=>{var e=h(e),t=e.data("field-id"),a=e.data("field-type"),a=yithBulk.inArray(("attribute"===a?"attr_pa_":"")+t,[...yithWcbep.enabledColumns,...yithWcbep.alwaysVisibleColumns]);!i&&a&&(i=!0),e.css("display",a?"auto":"none")}),i||t.find(`ul.yith-plugin-fw__tabs li.yith-plugin-fw__tab a[href="#${e.attr("id")}"]`).parent().css("display","none")})}},getCustomFieldTemplate:e=>!(!e||!h("script#tmpl-yith-wcbep-bulk-editing-custom-field-"+e).length)&&wp.template("yith-wcbep-bulk-editing-custom-field-"+e),getCustomTaxonomyTemplate:()=>wp.template("yith-wcbep-bulk-editing-custom-taxonomy"),renderCustomFieldsTab:()=>{if(!c.modal.customFieldsTabLoaded){const i=c.modal.elements.content.find("div#yith-wcbep-bulk-editing-custom-fields.yith-plugin-fw__tab-panel");Object.keys(yithWcbep.customFields).filter(e=>yithBulk.inArray(e,yithWcbep.enabledColumns)).forEach(e=>{var t=yithWcbep.customFields[e],a=c.getCustomFieldTemplate(t.type);i.append(a({id:e,label:t.label}))}),c.modal.customFieldsTabLoaded=!0}u()},renderCustomTaxonomiesTab:()=>{if(!c.modal.customTaxonomiesTabLoaded){const t=c.modal.elements.content.find("div#yith-wcbep-bulk-editing-custom-taxonomies.yith-plugin-fw__tab-panel"),a=c.getCustomTaxonomyTemplate();Object.keys(yithWcbep.columnList).filter(e=>0===e.indexOf("yith_wcbep_tf_")&&yithBulk.inArray(e,yithWcbep.enabledColumns)).forEach(e=>{t.append(a({id:e,taxonomy:e.substring(14),label:yithWcbep.columnList[e]}))}),c.modal.customTaxonomiesTabLoaded=!0}u()},productSelectionChange:()=>{var e=h("button#yith-wcbep-products-table-bulk-editing"),t=v.getSelectedProducts().length;e.find(".yith-wcbep-products-table-bulk-editing-selected-product-count").html(t?"("+t+")":""),c.handleBulkButtonsStatus()},handleBulkButtonsStatus:()=>{var e=h("button#yith-wcbep-products-table-bulk-editing, button#yith-wcbep-products-table-apply-bulk-action");v.getSelectedProducts().length?e.removeClass("yith-wcbep-button--disabled"):e.addClass("yith-wcbep-button--disabled")},handleFieldActionChange:function(){var e=h(this),t=e.val();let a=e.closest(".yith-wcbep-bulk-editing-field");var i=a.data("field-type");let l={display:"flex",toShow:[],toHide:[]};switch(i){case"number":l[yithBulk.inArray(t,["new","increase","decrease"])?"toShow":"toHide"].push(".yith-wcbep-bulk-editing-number-container");break;case"image":a=a.closest(".yith-plugin-fw__tab-panel#yith-wcbep-bulk-editing-images"),l["new"===t?"toShow":"toHide"].push(".yith-wcbep-bulk-editing-field-upload-image, .yith-wcbep-bulk-editing-field-upload-image .yith-wcbep-bulk-editing-upload-image-container");break;case"image-gallery":a=a.closest(".yith-plugin-fw__tab-panel#yith-wcbep-bulk-editing-images"),l[yithBulk.inArray(t,["new","prepend","append"])?"toShow":"toHide"].push(".yith-wcbep-bulk-editing-field-upload-multiple-images, .yith-wcbep-bulk-editing-field-upload-multiple-images .yith-wcbep-bulk-editing-upload-images-container");break;case"attribute":case"taxonomy":l[yithBulk.inArray(t,["new","add","remove"])?"toShow":"toHide"].push(`.yith-wcbep-bulk-editing-${i}-container`);break;case"date":l["new"===t?"toShow":"toHide"].push(".yith-wcbep-bulk-editing-date-container"),l[yithBulk.inArray(t,["increase-by-days","decrease-by-days"])?"toShow":"toHide"].push(".yith-wcbep-bulk-editing-days-container");break;case"price":case"decimal":l[yithBulk.inArray(t,["new","increase-by-value","decrease-by-value","increase-by-percentage","decrease-by-percentage"])?"toShow":"toHide"].push(".yith-wcbep-bulk-editing-"+i+"-container");break;case"sale-price":l[yithBulk.inArray(t,["new","increase-by-value","decrease-by-value","increase-by-percentage","decrease-by-percentage","decrease-by-percentage-from-regular","decrease-by-value-from-regular"])?"toShow":"toHide"].push(".yith-wcbep-bulk-editing-sale-price-container");break;default:l[yithBulk.inArray(t,["new","add","remove","replace","prepend","append"])?"toShow":"toHide"].push(".yith-wcbep-bulk-editing-"+i+"-container"),l["replace"===t?"toShow":"toHide"].push(".yith-wcbep-bulk-editing-replace-"+i+"-with-container"),l=wp.hooks.applyFilters("yithWcbepBulkEditingFieldActionChangeOptions",l,i,t)}var n,e=a.find(".yith-wcbep-bulk-editing-container__unit-of-measure");e.length&&(-1!==t.indexOf("percentage")?e.html("%"):(n=e.attr("data-unit-of-measure")!==undefined?e.data("unit-of-measure"):"",e.html(n))),l.toHide.length&&a.find(l.toHide.join(", ")).hide(),l.toShow.length&&a.find(l.toShow.join(", ")).css("display",l.display)},handleImageUpload:function(){const t=h(this),a=wp.media();a.open(),a.on("select",function(){var e=a.state().get("selection").first().toJSON();t.addClass("yith-wcbep-bulk-editing-upload-image-container--uploaded"),t.append(`<img src="${e.url}" data-image-id="${e.id}">`)})},handleImageRemove:function(){var e=h(this).closest(".yith-wcbep-bulk-editing-upload-image-container");e.find("img").remove(),e.removeClass("yith-wcbep-bulk-editing-upload-image-container--uploaded")},handleMultipleImageUpload:function(){const t=h(this),a=t.closest(".yith-wcbep-bulk-editing-upload-images-container"),e=wp.media({multiple:"add"}),i=wp.template("yith-wcbep-bulk-editing-upload-multiple-images-image");e.open(),e.on("select",function(){e.state().get("selection").map(e=>e.toJSON()).filter(e=>0===a.find(`img[src="${e.url}"]`).length).forEach(e=>t.before(i({image_url:e.url,image_id:e.id})))})},removeImageFromList:function(){h(this).closest(".yith-wcbep-bulk-editing-upload-image-container").remove()},toggleFieldAdvancedOptions:function(){var e=h(this).closest(".yith-wcbep-bulk-editing-field"),t=e.find(".yith-wcbep-bulk-editing-field-advanced-options");e.toggleClass("yith-wcbep-bulk-editing-field--has-advanced-options--visible"),t.slideToggle()},toggleSalePriceScheduleFields:function(){var e=h(this),t=e.closest(".yith-plugin-fw__tab-panel").find("#yith-wcbep-bulk-editing-field-sale_price_from, #yith-wcbep-bulk-editing-field-sale_price_to");e.toggleClass("yith-wcbep-bulk-editing-toggle-sale-price-scheduling--visible"),e.hasClass("yith-wcbep-bulk-editing-toggle-sale-price-scheduling--visible")?t.css("display","flex").hide().fadeIn():t.fadeOut()},editProducts:(e,t)=>{const a=h("table.yith_wcbep_products");let p=[];e.forEach(e=>{const r=a.find("tr.yith-wcbep-product-"+e);t.forEach(({field:e,fieldID:a,action:i,options:l})=>{a=r.find("td.column-"+("attribute"===e?"attr_pa_":"")+(a??""));let n="";if(a){let t=v.getProductFieldValue(a);switch(e){case"text":case"text-editor":switch(i){case"new":n=l?.value;break;case"prepend":n=l?.value+t;break;case"append":n=t+l?.value;break;case"remove":n=t.replaceAll(l?.value,"");break;case"replace":n=t.replaceAll(l?.search,l?.replace);break;case"empty":n=""}break;case"number":switch(i){case"new":n=l?.value;break;case"increase":""!==(n=l?.value)&&(n=+t+ +l?.value);break;case"decrease":n=(n=l?.value)&&+t-+l?.value;break;case"empty":n=""}break;case"image":"new"===i?n=l?.value:"empty"===i&&(n="");break;case"image-gallery":switch(t=t?JSON.parse(t):[],i){case"new":n=l?.value;break;case"append":n=[...t,...l?.value];break;case"prepend":n=[...l?.value,...t]}break;case"category":case"tag":case"products":case"badge":switch(t=t?JSON.parse(t):{},i){case"new":n=l?.value;break;case"add":n={...t,...l.value};break;case"remove":n=t,Object.keys(l.value).forEach(e=>n.hasOwnProperty(e)&&delete n[e]);break;case"replace":n=t;var o=Object.keys(t),c=Object.keys(l.search);o.length&&c.length&&new Set([...o,...c]).size===o.length&&(c.forEach(e=>delete n[e]),n={...n,...l.replace});break;case"empty":n={}}break;case"taxonomy":switch(t=t?JSON.parse(t):{is_visible:0,is_variation:0,terms:{}},n=t,i){case"new":n=l?.value??{};break;case"add":n={...n??{},...l?.value??{}};break;case"remove":Object.keys(l?.value??{}).forEach(e=>delete n[e]);break;case"empty":n={}}break;case"attribute":switch(t=t?JSON.parse(t):{is_visible:0,is_variation:0,terms:{}},n=t,i){case"new":n.terms=l?.value??{};break;case"add":n.terms={...n?.terms??{},...l?.value};break;case"remove":Object.keys(l?.value??{}).forEach(e=>delete n.terms[e]);break;case"empty":n={is_visible:0,is_variation:0,terms:{},"default":""};break;case"advanced-options":n={...n,...l}}break;case"decimal":case"price":switch(n=t,i){case"new":n=priceStringToNumber(l?.value);break;case"increase-by-value":""!==n&&(n=+n+priceStringToNumber(l?.value??0));break;case"decrease-by-value":n&&(n-=priceStringToNumber(l?.value??0));break;case"increase-by-percentage":n&&(n=(n*(1+priceStringToNumber(l?.value??0)/100)).toFixed(12),"decimal"===e)&&(n=Math.round(100*n)/100);break;case"decrease-by-percentage":n&&(n=(n*(1-priceStringToNumber(l?.value??0)/100)).toFixed(12),"decimal"===e)&&(n=Math.round(100*n)/100);break;case"empty":n=""}n=n&&Math.max(n,0);break;case"sale-price":n=t;var d=v.getProductFieldValue(r.find("td.column-regular_price"));switch(i){case"new":n=priceStringToNumber(l?.value);break;case"increase-by-value":n=+n+priceStringToNumber(l?.value??0);break;case"decrease-by-value":n-=priceStringToNumber(l?.value??0);break;case"increase-by-percentage":n*=1+priceStringToNumber(l?.value??0)/100;break;case"decrease-by-percentage":n*=1-priceStringToNumber(l?.value??0)/100;break;case"decrease-by-value-from-regular":n=d-priceStringToNumber(l?.value??0);break;case"decrease-by-percentage-from-regular":n=d*(1-priceStringToNumber(l?.value??0)/100)}n="empty"===i?"":Math.max(n,0);break;case"date":switch(i){case"new":n=l?.value;break;case"increase-by-days":t&&((s=new Date(1e3*t)).setDate(s.getUTCDate()+parseInt(l.value)),n=f(s));break;case"decrease-by-days":if(t){let e=new Date(1e3*t);var s=e.getTime()-864e5*parseInt(l.value);e=new Date(s),n=f(e)}break;case"empty":n=""}break;case"onoff":n=l.value;break;default:n=l.hasOwnProperty("value")&&l.hasOwnProperty("text")?l:l?.value}n=wp.hooks.applyFilters("yithWcbepBulkEditingEditProductsValue",n,e,i,l,t,r)}a=v.updateColumnValue(a,n,!1);a&&p.push(a)})}),v.addMove(p)},saveChanges:()=>{if(null!==c.modal){let b=[];c.modal.elements.content.find(".yith-wcbep-bulk-editing-field").each((e,t)=>{var a,i=h(t),l=i.data("field-type"),n=i.find("select.yith-wcbep-bulk-editing-field-action"),t=i.data("field-id");let o=n.length?n.val():"",c={};if(n.length){switch(l){case"text":case"text-editor":let t=i.find(".yith-wcbep-bulk-editing-"+l).val();if("text-editor"===l&&(t=g(i.find(".yith-wcbep-bulk-editing-"+l))),yithBulk.inArray(o,["new","prepend","append","remove"]))c.value=t;else if("replace"===o){let e=i.find(".yith-wcbep-bulk-editing-replace-"+l+"-with").val();"text-editor"===l&&(e=g(i.find(".yith-wcbep-bulk-editing-replace-"+l+"-with"))),c={search:"yes"===yithWcbep.useRegularExpressions?new RegExp(t,"g"):t,replace:e}}break;case"number":c.value=i.find("input.yith-wcbep-bulk-editing-number").val();break;case"image":"new"===o&&(d=i.parent().find(".yith-wcbep-bulk-editing-field.yith-wcbep-bulk-editing-field-upload-image img")).length&&(c.value={image_id:d.data("image-id"),image_url:d.attr("src")});break;case"image-gallery":yithBulk.inArray(o,["new","prepend","append"])?(d=i.parent().find(".yith-wcbep-bulk-editing-field.yith-wcbep-bulk-editing-field-upload-multiple-images img")).length&&(c.value=[],d.each((e,t)=>{t=h(t);c.value.push({image_id:t.data("image-id"),image_url:t.attr("src")})})):"empty"===o&&(c.value="");break;case"onoff":case"status":case"visibility":case"tax-status":case"shipping-class":case"stock-status":case"allow-backorders":case"product-type":c.value=o,c.text=n.find("option:selected").text();break;case"tax-class":"no-changes"!==o&&(c.value=o);break;case"taxonomy":case"attribute":var d=i.find(`select.yith-wcbep-bulk-editing-${l} option:selected`);yithBulk.inArray(o,["new","add","remove"])&&(c.value={},d.each((e,t)=>{c.value[t.value]=t.text}));break;case"sale-price":case"price":case"decimal":c.value=i.find(`.yith-wcbep-bulk-editing-${l}-container input`).val();break;case"date":yithBulk.inArray(o,["decrease-by-days","increase-by-days"])?c.value=i.find(".yith-wcbep-bulk-editing-days-container input").val():"new"===o&&(c.value=i.find(".yith-wcbep-bulk-editing-date-container input").val());break;default:"empty"!==o?(d=i.find(`select.yith-wcbep-bulk-editing-${l} option:selected`),yithBulk.inArray(o,["new","add","remove"])?(c.value={},d.each((e,t)=>{c.value[t.value]=t.text})):"replace"===o&&(a=i.find(`select.yith-wcbep-bulk-editing-replace-${l}-with option:selected`),c={search:{},replace:{}},d.each((e,t)=>{c.search[t.value]=t.text}),a.each((e,t)=>{c.replace[t.value]=t.text}))):c.value={},c=wp.hooks.applyFilters("yithWcbepBulkEditingSaveChangesOptions",c,l,o,i,n)}o&&"no-changes"!==o&&b.push({field:l,fieldID:t,action:o,options:c});var s,r,p,u={};i.hasClass("yith-wcbep-bulk-editing-field--has-advanced-options")&&(p=i.find(".yith-wcbep-bulk-editing-field-advanced-options"),"attribute"===l&&(s=p.find(".yith-wcbep-bulk-editing-field-advanced-option-visible-on-product-page .yith-wcbep-bulk-editing-field-advanced-option__field select").val(),r=p.find(".yith-wcbep-bulk-editing-field-advanced-option-used-for-variation .yith-wcbep-bulk-editing-field-advanced-option__field select").val(),p=p.find(".yith-wcbep-bulk-editing-field-advanced-option-default-term .yith-wcbep-bulk-editing-field-advanced-option__field select option:selected"),""!==s&&(u.is_visible=+("yes"===s)),""!==r&&(u.is_variation=+("yes"===r)),p.length)&&(u["default"]={},u["default"][p[0].value]=p[0].text),Object.values(u).length)&&b.push({field:l,fieldID:t,action:"advanced-options",options:u})}}),c.editProducts(v.getSelectedProducts(),b),c.closeModal()}}};v.init(),o.init(),c.init();window.addEventListener("beforeunload",function(e){if(Object.keys(v.getChanges()).length)return e.preventDefault(),e.returnValue=!0},{capture:!0})});