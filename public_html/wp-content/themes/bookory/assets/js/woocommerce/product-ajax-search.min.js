!function(e){"use strict";function t(){const t={parent:e(".woocommerce-product-search"),inputSearch:e(".ajax-search .woocommerce-product-search .search-field"),result:e(".ajax-search-result"),dropdown:e(".input-dropdown-inner"),dropdownLink:e(".input-dropdown-inner > a"),dropdownList:e(".input-dropdown-inner > .list-wrapper"),dropdownSelect:e(".input-dropdown-inner > select")},a=wp.template("ajax-live-search-template"),n=100,r=2,i=300;let s=null,c=null;function o(){t.result.hide(),t.dropdownList.slideUp(n),t.dropdown.removeClass("dd-shown")}function l(e,a){t.dropdownList.find(".current-item").removeClass("current-item"),t.dropdown.find(`[data-val="${e}"]`).parent().addClass("current-item"),t.dropdownLink.find("span").text(a),t.dropdownSelect.val(e).trigger("cat_selected")}function d(e){t.dropdownList.find("ul:not(.children) > li:first-child").toggle(0!=e)}function p(n){const r=t.parent.find('select[name="product_cat"]').val()||"";c=e.ajax({url:bookoryAjax.ajaxurl,type:"POST",data:{action:"bookory_ajax_search_products",query:n,product_cat:r,nonce:bookoryAjax.nonce||""},beforeSend:()=>t.parent.addClass("loading"),success:function(n){try{const r="string"==typeof n?e.parseJSON(n):n;if(t.result.empty(),r&&r.length>0)e.each(r,(e,n)=>{if(n&&n.url&&n.value){const e={url:u(n.url),title:u(n.value),img:u(n.img||""),price:n.price||""};t.result.append(a(e))}}),t.result.show();else t.result.hide()}catch(e){console.error("Error parsing search results:",e),t.result.hide()}},error:(e,t,a)=>"abort"!==t&&console.error("Search error:",a),complete:()=>{t.parent.removeClass("loading"),c=null}})}function u(e){if(!e)return"";const t={"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#039;"};return e.toString().replace(/[&<>"']/g,e=>t[e])}t.inputSearch.length&&(e("body").on("click",o),t.dropdownLink.on("click",function(e){e.preventDefault();const a=t.dropdown.hasClass("dd-shown");return t.dropdown.toggleClass("dd-shown",!a),t.dropdownList.slideToggle(n),t.result.hide(),!1}),t.dropdownList.on("click","a",function(a){a.preventDefault();const r=e(this).data("val"),i=e(this).text();l(r,i),d(r),t.dropdownList.slideUp(n),t.dropdown.removeClass("dd-shown")}),t.dropdownSelect.on("change",function(){const t=e(this).val(),a=e(this).find("option:selected").text();l(t,a),d(t)}),t.inputSearch.on("keyup",function(){const e=this.value.trim();s&&clearTimeout(s),c&&(c.abort(),c=null),e.length>r?s=setTimeout(()=>p(e),i):(t.result.hide().empty(),t.parent.removeClass("loading"))}).on("click",e=>e.stopPropagation()).on("focus",function(){t.dropdownList.slideUp(n),t.dropdown.removeClass("dd-shown");const e=this.value.trim();e.length>r&&t.result.show()}))}e(document).ready(t)}(jQuery);