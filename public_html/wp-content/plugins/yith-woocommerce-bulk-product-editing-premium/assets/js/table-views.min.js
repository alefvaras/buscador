jQuery(function(c){var n=()=>{o(c("select.yith-wcbep-table-view-number-condition__operator.wc-enhanced-select, select.yith-wcbep-table-view-price-condition__operator.wc-enhanced-select")),c(document.body).trigger("yith-framework-enhanced-select-init"),c(document.body).trigger("wc-enhanced-select-init")},o=e=>{var t;e.length&&e.select2({minimumResultsForSearch:-1,templateResult:t=function(e){return e.id?c(`<span class="yith-wcbep-select2-option"><span class="yith-wcbep-select2-option-symbol">${{greater:">",less:"<",equal:"=","greater-eq":"≥","less-eq":"≤"}[e.id]}</span>${e.text}</span>`):e.text},templateSelection:t}).removeClass("wc-enhanced-select")},l=e=>{e.block({message:"",overlayCSS:{backgroundColor:"#ffffff",opacity:.8,cursor:"wait"}})},p=e=>e.unblock(),s=e=>e.slideUp("normal",()=>e.remove()),w={modal:null,templates:{editTableView:wp.template("yith-wcbep-edit-table-view"),tableView:wp.template("yith-wcbep-table-view"),conditions:{condition:wp.template("yith-wcbep-edit-table-view-condition"),text:wp.template("yith-wcbep-edit-table-view-text"),price:wp.template("yith-wcbep-edit-table-view-price"),number:wp.template("yith-wcbep-edit-table-view-number"),status:wp.template("yith-wcbep-edit-table-view-status"),productVisibility:wp.template("yith-wcbep-edit-table-view-product-visibility"),stockStatus:wp.template("yith-wcbep-edit-table-view-stock-status"),featured:wp.template("yith-wcbep-edit-table-view-featured"),backorder:wp.template("yith-wcbep-edit-table-view-backorder"),shippingClass:wp.template("yith-wcbep-edit-table-view-shipping-class"),productType:wp.template("yith-wcbep-edit-table-view-product-type"),category:wp.template("yith-wcbep-edit-table-view-category"),tag:wp.template("yith-wcbep-edit-table-view-tag"),attribute:wp.template("yith-wcbep-edit-table-view-attribute")}},init:function(){c(document).on("click","ul#select2-yith-wcbep-table-view-results li:nth-last-child(1), button.yith-wcbep-empty-state-manage-views",w.openTableViewsModal),c(document).on("change","select#yith-wcbep-table-view",w.handleTableViewChange),c(document).on("change","select.yith-wcbep-table-view-attribute-condition",w.handleAttributeConditionTypeChange),c(document).on("change","select.yith-wcbep-table-view-product-type-condition__value",w.handleProductTypeChange)},selectView:function(e){c(e.target).is("button")||c(this).find("input.yith-wcbep-table-view-input").prop("checked",!0).trigger("change")},getModalContentElement:function(){return!!(this.modal&&this.modal?.elements&&this.modal.elements?.content)&&c(this.modal.elements.content)},openTableViewsModal:function(){var e=c("#yith-wcbep-table-view"),e=(e.select2("close"),w.modal=yith.ui.modal({...yithWcbep.modals.tableViews,onClose:w.handleTableViewsModalClosing}),w.getModalContentElement().find("input#yith-wcbep-table-view-"+e.val()).prop("checked",!0),w.getModalContentElement()),t=w.modal.elements.footer;e&&(n(),e.on("click",".yith-wcbep-table-view-wrapper:not(.yith-wcbep-table-view-wrapper--editing) .yith-wcbep-table-view-action-edit",w.editView),e.on("click",".yith-wcbep-table-view-create:not(.yith-wcbep-table-view-create--creating)",w.createTableViewOptions),e.on("change","select.yith-wcbep-edit-table-view-condition-type-select",w.handleConditionTypeChange),e.on("click",".yith-wcbep-edit-table-view-add-condition",w.addCondition),e.on("change keyup","input#yith-wcbep-edit-table-view-name",w.updateViewName),e.on("click",".yith-wcbep-edit-table-view-remove-condition",w.deleteCondition),e.on("click",".yith-wcbep-table-view-wrapper:not(.yith-wcbep-table-view-create) .yith-wcbep-edit-table-view-cancel-button",w.cancelViewEditing),e.on("click",".yith-wcbep-table-view-create .yith-wcbep-edit-table-view-cancel-button",w.cancelViewCreating),e.on("click",".yith-wcbep-table-view-create .yith-wcbep-edit-table-view-save-button",w.createTableView),e.on("click",".yith-wcbep-table-view-actions .yith-wcbep-table-view-action-delete",w.showDeleteConfimation),e.on("click",".yith-wcbep-table-view-delete-confirmation__confirm",w.deleteTableView),e.on("click",".yith-wcbep-table-view-delete-confirmation__not-confirm",w.hideDeleteConfimation),e.on("click",".yith-wcbep-table-view-actions .yith-wcbep-table-view-action-clone",w.cloneTableView),e.on("click",".yith-wcbep-edit-table-view-save-button",w.updateTableView),e.on("click",".yith-wcbep-table-view-wrapper:not(.yith-wcbep-table-view-wrapper--editing)",w.selectView),e.on("click",".yith-wcbep-table-view-wrapper:not(.yith-wcbep-table-view-wrapper--editing)",w.selectView),t.on("click",".yith-wcbep-table-view-modal-button-save",w.saveModal),t.on("click",".yith-wcbep-table-view-modal-button-cancel",w.modal.close))},saveModal:()=>{w?.modal&&(w.handleTableViewsModalClosing.save=!0,w.modal.close())},handleTableViewsModalClosing:function(){var e,i,t,a,n=w.getModalContentElement();n&&(a=n.find("input.yith-wcbep-table-view-input:checked"),e=c("#yith-wcbep-table-view"),i=e.find("option:nth-last-child(1)"),t=e.val(),a=a.val(),e.find("option").not(i).remove(),"custom-filters"===t&&i.before(`<option value="custom-filters">${yithWcbep.i18n.customFilters}</option>`),n.find(".yith-wcbep-table-view-wrapper:not(.yith-wcbep-table-view-create)").each(function(){var e=c(this).closest(".yith-wcbep-table-view-container"),t=e.data("view-properties"),e=e.data("view-key"),t=t.name;i.before(`<option value="${e}">${t}</option>`)}),w.handleTableViewsModalClosing?.save?w.handleTableViewsModalClosing.save=!1:a=t,e.find('option[value="'+c.escapeSelector(a)+'"]').attr("selected",!0),!w.handleTableViewsModalClosing?.forceUpdate&&t===a||(e.trigger("change"),w.handleTableViewsModalClosing.forceUpdate=!1),n.find(".yith-wcbep-edit-table-view-form").remove(),n.find(".yith-wcbep-table-view-wrapper.yith-wcbep-table-view-wrapper--editing").removeClass("yith-wcbep-table-view-wrapper--editing"),w.cancelViewCreating(),yithWcbep.modals.tableViews.content=n.html())},editView:function(){var t=c(this).closest(".yith-wcbep-table-view-wrapper");if(!t.hasClass("yith-wcbep-table-view-wrapper--editing")){t.addClass("yith-wcbep-table-view-wrapper--editing");var i=JSON.parse(t.closest(".yith-wcbep-table-view-container").attr("data-view-properties")),a=c(w.templates.editTableView({viewName:i.name}));t.append(a);let e=!1;i?.conditions&&(e=a.find(".yith-wcbep-edit-table-view-form-conditions")).append(w.getConditionsFields(i.conditions)),n(),e&&e.find("select.yith-wcbep-table-view-product-type-condition__value").trigger("change"),a.slideDown({start:function(){c(this).css("display","flex")}})}},addDynamicConditionsToSelect:e=>{const t=c(e);t.length&&Object.keys(yithWcbep.columnList).filter(e=>0===e.indexOf("yith_wcbep_tf_")||0===e.indexOf("yith_wcbep_cf_")).forEach(e=>t.append(`<option value="${e}">${yithWcbep.columnList[e]}</option>`))},checkMandatoryCondition:e=>{var t,i;e.length&&(t=w.getViewConditions(e),i=e.find(".yith-wcbep-edit-table-view-mandatory-condition-message"),e=e.find(".yith-wcbep-edit-table-view-form-conditions"),t.length?(e.removeClass("yith-wcbep-edit-table-view-form-conditions--invalid"),i.slideUp()):(i.slideDown(),e.addClass("yith-wcbep-edit-table-view-form-conditions--invalid")))},updateViewName:function(){var e=c(this),t=e.closest(".yith-wcbep-edit-table-view-name-wrapper"),i=e.closest(".yith-wcbep-table-view-wrapper"),a=i.find("label.yith-wcbep-table-view-name"),n=e.val()?.trim(),i=i.find(".yith-wcbep-edit-table-view-mandatory-name-message");n?(t.removeClass("yith-wcbep-edit-table-view-name--invalid"),i.slideUp()):(t.addClass("yith-wcbep-edit-table-view-name--invalid"),i.slideDown(),n=w.modal.elements.content[0].getBoundingClientRect(),t=e[0].getBoundingClientRect(),(n.y>t.y||n.y+n.height<t.y)&&(w.modal.elements.content[0].scrollTop-=n.y-t.y+70)),a.length&&a.html(e.val())},cancelViewEditing:function(){var e=c(this).closest(".yith-wcbep-edit-table-view-form"),t=e.closest(".yith-wcbep-table-view-container"),i=t.data("view-properties");e.closest(".yith-wcbep-table-view-wrapper").removeClass("yith-wcbep-table-view-wrapper--editing"),e.slideUp("normal",function(){e.remove()}),i&&i.hasOwnProperty("name")&&t.find(".yith-wcbep-table-view-name").html(i.name)},cancelViewCreating:function(){var e=w.getModalContentElement().find(".yith-wcbep-table-view-wrapper.yith-wcbep-table-view-create");s(e.find(".yith-wcbep-table-view-create-form")),e.find(".yith-wcbep-table-view-create-label").slideDown(),e.removeClass("yith-wcbep-table-view-create--creating")},addCondition:function(e,t){t=undefined===t||!!t,e=e&&e?.length?e:c(this).closest(".yith-wcbep-edit-table-view-form").find(".yith-wcbep-edit-table-view-form-conditions");var i=c(w.templates.conditions.condition({}));i.hide(),e.append(i),w.addDynamicConditionsToSelect(i.find("select")),n(),t?i.slideDown():i.show()},deleteCondition:function(){c(this).closest(".yith-wcbep-edit-table-view-condition").remove()},handleConditionTypeChange:function(){var e=c(this),t=e.closest(".yith-wcbep-edit-table-view-condition-options").find(".yith-wcbep-edit-table-view-condition-option"),i=e.val(),a=w.getConditionOptionsFields({type:i});a?(t.html(a),a=w.getConditionType(i),yithBulk.inArray(a,["number","price"])?o(t.find("select.yith-wcbep-table-view-"+a+"-condition__operator")):n()):t.html(""),w.checkMandatoryCondition(e.closest(".yith-wcbep-edit-table-view-form"))},handleProductTypeChange:function(){var e=c(this);e.closest(".yith-wcbep-table-view-product-type-condition").find(".yith-wcbep-table-view-product-type-include-variation").css("display",-1!==["any","variable"].indexOf(e.val())?"block":"none")},handleAttributeConditionTypeChange:function(){var e=c(this);e.parent().find(".yith-plugin-fw-select2-wrapper").css("display",-1!==["has","has-not"].indexOf(e.val())?"block":"none")},getConditionsFields:function(e){var o=c("<div></div>");return c.each(e,function(e,t){var i,a,n;t.hasOwnProperty("type")&&(i=c(w.templates.conditions.condition({condition:t.type})),a=w.getConditionOptionsFields(t),n=i.find("select.yith-wcbep-edit-table-view-condition-type-select"),w.addDynamicConditionsToSelect(n),n.find('option[value="'+c.escapeSelector(t.type)+'"]').attr("selected",!0),a&&i.find(".yith-wcbep-edit-table-view-condition-option").html(a),o.append(i))}),o.html()},getConditionType:e=>{var t={shortdesc:"text",desc:"text",title:"text",sku:"text","stock-quantity":"number",weight:"number",height:"number",width:"number",length:"number","regular-price":"price","sale-price":"price"};return e=0===e.indexOf("yith_wcbep_tf_")?"custom-taxonomy":(0===e.indexOf("yith_wcbep_cf_")&&yithWcbep.customFields.hasOwnProperty(e)&&(e=yithWcbep.customFields[e].type),t.hasOwnProperty(e)?t[e]:e)},getConditionTemplate:e=>(e=w.getConditionType(e),!!c("script#tmpl-yith-wcbep-edit-table-view-"+e).length&&wp.template("yith-wcbep-edit-table-view-"+e)),getConditionOptionsFields:function(t){var a=!1;if(t.hasOwnProperty("type")){t.hasOwnProperty("options")||(t.options={});var e=w.getConditionTemplate(t.type);if(e){var a=c(e(t.options)),i=0===t.type.indexOf("yith_wcbep_cf_")||0===t.type.indexOf("yith_wcbep_tf_")?w.getConditionType(t.type):t.type;switch(i){case"text":case"desc":case"shortdesc":case"title":case"sku":t.options.hasOwnProperty("compare")&&a.find('select option[value="'+c.escapeSelector(t.options.compare)+'"]').attr("selected",!0);break;case"sale-price":case"regular-price":case"price":t.options.hasOwnProperty("operator")&&a.find('select.yith-wcbep-table-view-price-condition__operator option[value="'+c.escapeSelector(t.options.operator)+'"]').attr("selected",!0);break;case"stock-quantity":case"weight":case"height":case"width":case"length":t.options.hasOwnProperty("operator")&&a.find('select.yith-wcbep-table-view-number-condition__operator option[value="'+c.escapeSelector(t.options.operator)+'"]').attr("selected",!0);break;case"product-type":t.options.hasOwnProperty("value")&&(a.find("select.yith-wcbep-table-view-"+t.type+'-condition__value option[value="'+c.escapeSelector(t.options.value)+'"]').attr("selected",!0),"yes"===t.options?.include_variations)&&a.find("input.yith-wcbep-table-view-product-type-include-variation-input").attr("checked",!0);break;case"custom-taxonomy":a=c(e({taxonomyID:t.type.substr(14)}));case"shipping-class":case"category":case"tag":const n=a.find(`select.yith-wcbep-table-view-${i}-condition__compare`),o=a.find(`select.yith-wcbep-table-view-${i}-condition__value`);n.find(`option[value="${t.options.condition}"]`).attr("selected",!0),Object.keys(t.options?.taxonomies??{}).forEach(e=>{o.append(c(`<option value="${e}" selected>${t.options.taxonomies[e]}</option>`))});break;case"attribute":Array.isArray(t.options)&&t.options.forEach(t=>{t.terms=t.terms??{};var e=a.find(".yith-wcbep-table-view-attribute__"+(t?.attribute_id??""));if(e.length&&(e.find("select.yith-wcbep-table-view-attribute-condition").find(`option[value="${t.condition}"]`).attr("selected",!0),-1!==["has","has-not"].indexOf(t.condition))){const i=e.find("select.yith-wcbep-table-view-attribute-condition__value");i.parent().css("display","block"),Object.keys(t.terms).forEach(e=>{i.append(c(`<option value="${e}" selected>${t.terms[e]}</option>`))})}});break;default:t.options.hasOwnProperty("value")&&a.find("select.yith-wcbep-table-view-"+t.type+'-condition__value option[value="'+c.escapeSelector(t.options.value)+'"]').attr("selected",!0)}a=wp.hooks.applyFilters("yithWcbepTableViewGetConditionOptionsFields",a,t,i)}}return a},createTableViewOptions:function(){var e,t,i=c(this);i.hasClass("yith-wcbep-table-view-create--creating")||(i.addClass("yith-wcbep-table-view-create--creating"),t=i.find(".yith-wcbep-table-view-create-label"),(e=c('<div class="yith-wcbep-table-view-create-form"></div>')).html(c(w.templates.editTableView({viewName:""}))),i.append(e),w.addCondition(e.find(".yith-wcbep-edit-table-view-form-conditions"),!1),t.slideUp(),e.find(".yith-wcbep-edit-table-view-form").slideDown({start:function(){c(this).css("display","flex")}}),i.hasClass("yith-wcbep-table-view-create--creating")&&(t=w.getModalContentElement())&&t.animate({scrollTop:t.height()+400},400))},createTableView:function(){var e=c(this).closest(".yith-wcbep-table-view-wrapper"),t=e.find("input#yith-wcbep-edit-table-view-name"),i={name:t.val().trim(),conditions:w.getViewConditions(e)};t.trigger("change"),w.checkMandatoryCondition(e),i.name&&i.conditions.length&&(l(e),c.ajax({data:{view_options:i,view_action:"create",action:yithWcbep.actions.tableViewAction,security:yithWcbep.security.tableViewAction},type:"POST",dataType:"json",url:yithWcbep.ajaxurl,success:function(e){e.hasOwnProperty("success")&&e.hasOwnProperty("view")&&"success"===e.success&&(w.getModalContentElement().find(".yith-wcbep-table-view-wrapper.yith-wcbep-table-view-create").before(w.templates.tableView(e.view)),w.cancelViewCreating())},complete:function(){p(e)}}))},showDeleteConfimation:function(){c(this).closest(".yith-wcbep-table-view-container").addClass("yith-wcbep-table-view-show-delete-confirmation")},hideDeleteConfimation:function(){c(this).closest(".yith-wcbep-table-view-container").removeClass("yith-wcbep-table-view-show-delete-confirmation")},deleteTableView:function(){var t=c(this).closest(".yith-wcbep-table-view-container"),e=t.closest(".yith-wcbep-table-views-list"),i=t.data("view-key");l(e),c.ajax({data:{view_key:i,view_action:"delete",action:yithWcbep.actions.tableViewAction,security:yithWcbep.security.tableViewAction},type:"POST",dataType:"json",url:yithWcbep.ajaxurl,success:function(e){"success"===e?.success&&(t.find("input.yith-wcbep-table-view-input").is(":checked")&&(t.closest(".yith-wcbep-table-views-list").find("input#yith-wcbep-table-view-table-view-all").prop("checked",!0).trigger("change"),w.handleTableViewsModalClosing.forceUpdate=!0),t.remove())},complete:function(){p(e)}})},cloneTableView:function(){var t=c(this).closest(".yith-wcbep-table-view-container"),e=t.closest(".yith-wcbep-table-views-list"),i=t.data("view-key");l(e),c.ajax({data:{view_key:i,view_action:"clone",action:yithWcbep.actions.tableViewAction,security:yithWcbep.security.tableViewAction},type:"POST",dataType:"json",url:yithWcbep.ajaxurl,success:function(e){"success"===e?.success&&e?.view&&t.after(w.templates.tableView(e.view))},complete:function(){p(e)}})},updateTableView:function(){var t=c(this).closest(".yith-wcbep-table-view-container"),e=t.find("input#yith-wcbep-edit-table-view-name"),i={name:e.val()?.trim(),conditions:w.getViewConditions(t)},a=t.data("view-key");e.trigger("change"),w.checkMandatoryCondition(t),i.name&&i.conditions.length&&(l(t),c.ajax({data:{view_key:a,view_properties:i,view_action:"update",action:yithWcbep.actions.tableViewAction,security:yithWcbep.security.tableViewAction},type:"POST",dataType:"json",url:yithWcbep.ajaxurl,success:function(e){e&&"success"===e?.success&&e?.viewProperties&&(s(t.find(".yith-wcbep-edit-table-view-form")),t.find(".yith-wcbep-table-view-wrapper").removeClass("yith-wcbep-table-view-wrapper--editing"),t.attr("data-view-properties",JSON.stringify(e.viewProperties)),t.find(".yith-wcbep-table-view-name").html(e.viewProperties.name),w.getSelectedViewFromSelect()===a)&&(w.handleTableViewsModalClosing.forceUpdate=1)},complete:function(){p(t)}}))},getSelectedViewFromSelect:()=>c("#yith-wcbep-table-view").val(),getViewConditions:function(e){let a=[];return e.find(".yith-wcbep-edit-table-view-condition-type select.yith-wcbep-edit-table-view-condition-type-select").each(function(){var e=c(this),t=e.closest(".yith-wcbep-edit-table-view-condition-type").next();let i=e.val();if(i&&t.hasClass("yith-wcbep-edit-table-view-condition-option")||"include-variations"===i){let n={type:i};switch(i=0!==i.indexOf("yith_wcbep_cf_")&&0!==i.indexOf("yith_wcbep_tf_")?i:w.getConditionType(i)){case"title":case"desc":case"shortdesc":case"sku":case"text":n.options={compare:t.find("select.yith-wcbep-table-view-text-condition__compare").val(),value:t.find("input.yith-wcbep-table-view-text-condition__value").val()};break;case"sale-price":case"regular-price":case"price":n.options={operator:t.find("select.yith-wcbep-table-view-price-condition__operator").val(),value:t.find("input.yith-wcbep-table-view-price-condition__value").val()};break;case"stock-quantity":case"weight":case"height":case"width":case"length":n.options={operator:t.find("select.yith-wcbep-table-view-number-condition__operator").val(),value:t.find("input.yith-wcbep-table-view-number-condition__value").val()};break;case"attribute":n.options=[],t.find(".yith-wcbep-table-view-attribute").each((e,t)=>{var t=c(t),i=t.data("attribute-id"),a=t.find("select.yith-wcbep-table-view-attribute-condition").val(),i={attribute_id:i,condition:a};-1!==["has","has-not"].indexOf(a)&&(a=t.find("select.yith-wcbep-table-view-attribute-condition__value"),i.terms=a.val(),i.taxonomy=a.data("taxonomy")),n.options.push(i)});break;case"custom-taxonomy":case"category":case"tag":case"shipping-class":n.options={condition:t.find(`select.yith-wcbep-table-view-${i}-condition__compare`).val(),taxonomies:t.find(`select.yith-wcbep-table-view-${i}-condition__value`).val()};break;case"product-type":n.options={value:t.find("select.yith-wcbep-table-view-"+i+"-condition__value").val(),include_variations:t.find("input.yith-wcbep-table-view-product-type-include-variation-input").prop("checked")?"yes":"no"};break;case"include-variations":n.options={value:"yes"};break;default:n.options={value:t.find("select.yith-wcbep-table-view-"+i+"-condition__value").val()}}(n=wp.hooks.applyFilters("yithWcbepGetTableViewConditionsCondition",n,i,t))?.options&&a.push(n)}}),a},handleTableViewChange:function(e,t){t&&t.hasOwnProperty("updateTable")&&!t.updateTable||c(document).trigger("yith-wcbep-load-table",{update_table_view:"yes",paged:1})}};w.init()});